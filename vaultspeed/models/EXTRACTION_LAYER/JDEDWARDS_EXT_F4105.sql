{{
	config(
		materialized='incremental',
		pre_hook= [
			'{% if var("load_type") == "INCR" and var("source") == "JDEDWARDS" %} TRUNCATE TABLE {{ this }}; {% endif %}',
			'{% if var("load_type") == "INIT" and var("source") == "JDEDWARDS" %} TRUNCATE TABLE {{ this }}; {% endif %}'
		],
		alias='F4105',
		schema='JDEDWARDS_EXT',
		tags=['JDEDWARDS', 'EXT_JDE_ITEMCOST_INCR', 'EXT_JDE_ITEMCOST_INIT']
	)
}}
select * from (
	WITH "CALCULATE_BK" AS 
	( 
		SELECT 
			  "LCI_SRC"."LOAD_CYCLE_ID" AS "LOAD_CYCLE_ID"
			, DATEADD(microsecond, 2*row_number() over (order by "TDFV_SRC"."CDC_TIMESTAMP"),
				TO_TIMESTAMP_NTZ(CURRENT_TIMESTAMP()))   AS "LOAD_DATE"
			, "TDFV_SRC"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
			, COALESCE("TDFV_SRC"."JRN_FLAG","MEX_SRC"."ATTRIBUTE_VARCHAR") AS "JRN_FLAG"
			, "TDFV_SRC"."RECORD_TYPE" AS "RECORD_TYPE"
			, "TDFV_SRC"."COITM" AS "COITM"
			, "TDFV_SRC"."COMCU" AS "COMCU"
			, "TDFV_SRC"."COLOCN" AS "COLOCN"
			, "TDFV_SRC"."COLOTN" AS "COLOTN"
			, "TDFV_SRC"."COLEDG" AS "COLEDG"
			, COALESCE(UPPER( TO_CHAR("TDFV_SRC"."COITM")),"MEX_SRC"."KEY_ATTRIBUTE_FLOAT") AS "COITM_BK"
			, COALESCE(REPLACE(TRIM( "TDFV_SRC"."COMCU"),'\#','\\' || '\#'),"MEX_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "COMCU_BK"
			, COALESCE(REPLACE(TRIM( "TDFV_SRC"."COLOCN"),'\#','\\' || '\#'),"MEX_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "COLOCN_BK"
			, COALESCE(REPLACE(TRIM( "TDFV_SRC"."COLOTN"),'\#','\\' || '\#'),"MEX_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "COLOTN_BK"
			, COALESCE(REPLACE(TRIM( "TDFV_SRC"."COLEDG"),'\#','\\' || '\#'),"MEX_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "COLEDG_BK"
			, REPLACE(TRIM( "TDFV_SRC"."COMCU"),'\#','\\' || '\#') AS "IBMCU_FK_ITEMBRANCH_COITM_BK"
			, UPPER( TO_CHAR("TDFV_SRC"."COITM")) AS "IBITM_FK_ITEMBRANCH_COITM_BK"
			, REPLACE(TRIM( "TDFV_SRC"."COMCU"),'\#','\\' || '\#') AS "MCMCU_FK_BUSINESSUNITMASTER_COMCU_BK"
			, UPPER( TO_CHAR("TDFV_SRC"."COITM")) AS "IMITM_FK_ITEMMASTER_COITM_BK"
			, "TDFV_SRC"."COLITM" AS "COLITM"
			, "TDFV_SRC"."COAITM" AS "COAITM"
			, "TDFV_SRC"."COLOTG" AS "COLOTG"
			, "TDFV_SRC"."COUNCS" AS "COUNCS"
			, "TDFV_SRC"."COCSPO" AS "COCSPO"
			, "TDFV_SRC"."COCSIN" AS "COCSIN"
			, "TDFV_SRC"."COURCD" AS "COURCD"
			, "TDFV_SRC"."COURDT" AS "COURDT"
			, "TDFV_SRC"."COURAT" AS "COURAT"
			, "TDFV_SRC"."COURAB" AS "COURAB"
			, "TDFV_SRC"."COURRF" AS "COURRF"
			, "TDFV_SRC"."COUSER" AS "COUSER"
			, "TDFV_SRC"."COPID" AS "COPID"
			, "TDFV_SRC"."COJOBN" AS "COJOBN"
			, "TDFV_SRC"."COUPMJ" AS "COUPMJ"
			, "TDFV_SRC"."COTDAY" AS "COTDAY"
			, "TDFV_SRC"."COCCFL" AS "COCCFL"
			, "TDFV_SRC"."COCRCS" AS "COCRCS"
			, "TDFV_SRC"."COOSTC" AS "COOSTC"
			, "TDFV_SRC"."COSTOC" AS "COSTOC"
		FROM {{ ref('JDEDWARDS_DFV_VW_F4105') }} "TDFV_SRC"
		INNER JOIN {{ source('JDEDWARDS_MTD', 'LOAD_CYCLE_INFO') }} "LCI_SRC" ON  1 = 1
		INNER JOIN {{ source('JDEDWARDS_MTD', 'MTD_EXCEPTION_RECORDS') }} "MEX_SRC" ON  1 = 1
		WHERE  "MEX_SRC"."RECORD_TYPE" = 'N'
	)
	, "EXT_UNION" AS 
	( 
		SELECT 
			  "CALCULATE_BK"."LOAD_CYCLE_ID" AS "LOAD_CYCLE_ID"
			, "CALCULATE_BK"."LOAD_DATE" AS "LOAD_DATE"
			, "CALCULATE_BK"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
			, "CALCULATE_BK"."JRN_FLAG" AS "JRN_FLAG"
			, "CALCULATE_BK"."RECORD_TYPE" AS "RECORD_TYPE"
			, "CALCULATE_BK"."COITM" AS "COITM"
			, "CALCULATE_BK"."COMCU" AS "COMCU"
			, "CALCULATE_BK"."COLOCN" AS "COLOCN"
			, "CALCULATE_BK"."COLOTN" AS "COLOTN"
			, "CALCULATE_BK"."COLEDG" AS "COLEDG"
			, "CALCULATE_BK"."COITM_BK" AS "COITM_BK"
			, "CALCULATE_BK"."COMCU_BK" AS "COMCU_BK"
			, "CALCULATE_BK"."COLOCN_BK" AS "COLOCN_BK"
			, "CALCULATE_BK"."COLOTN_BK" AS "COLOTN_BK"
			, "CALCULATE_BK"."COLEDG_BK" AS "COLEDG_BK"
			, "CALCULATE_BK"."IBMCU_FK_ITEMBRANCH_COITM_BK" AS "IBMCU_FK_ITEMBRANCH_COITM_BK"
			, "CALCULATE_BK"."IBITM_FK_ITEMBRANCH_COITM_BK" AS "IBITM_FK_ITEMBRANCH_COITM_BK"
			, "CALCULATE_BK"."MCMCU_FK_BUSINESSUNITMASTER_COMCU_BK" AS "MCMCU_FK_BUSINESSUNITMASTER_COMCU_BK"
			, "CALCULATE_BK"."IMITM_FK_ITEMMASTER_COITM_BK" AS "IMITM_FK_ITEMMASTER_COITM_BK"
			, "CALCULATE_BK"."COLITM" AS "COLITM"
			, "CALCULATE_BK"."COAITM" AS "COAITM"
			, "CALCULATE_BK"."COLOTG" AS "COLOTG"
			, "CALCULATE_BK"."COUNCS" AS "COUNCS"
			, "CALCULATE_BK"."COCSPO" AS "COCSPO"
			, "CALCULATE_BK"."COCSIN" AS "COCSIN"
			, "CALCULATE_BK"."COURCD" AS "COURCD"
			, "CALCULATE_BK"."COURDT" AS "COURDT"
			, "CALCULATE_BK"."COURAT" AS "COURAT"
			, "CALCULATE_BK"."COURAB" AS "COURAB"
			, "CALCULATE_BK"."COURRF" AS "COURRF"
			, "CALCULATE_BK"."COUSER" AS "COUSER"
			, "CALCULATE_BK"."COPID" AS "COPID"
			, "CALCULATE_BK"."COJOBN" AS "COJOBN"
			, "CALCULATE_BK"."COUPMJ" AS "COUPMJ"
			, "CALCULATE_BK"."COTDAY" AS "COTDAY"
			, "CALCULATE_BK"."COCCFL" AS "COCCFL"
			, "CALCULATE_BK"."COCRCS" AS "COCRCS"
			, "CALCULATE_BK"."COOSTC" AS "COOSTC"
			, "CALCULATE_BK"."COSTOC" AS "COSTOC"
		FROM "CALCULATE_BK" "CALCULATE_BK"
	)
	SELECT 
		  "EXT_UNION"."LOAD_CYCLE_ID" AS "LOAD_CYCLE_ID"
		, "EXT_UNION"."LOAD_DATE" AS "LOAD_DATE"
		, "EXT_UNION"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
		, "EXT_UNION"."JRN_FLAG" AS "JRN_FLAG"
		, "EXT_UNION"."RECORD_TYPE" AS "RECORD_TYPE"
		, "EXT_UNION"."COITM" AS "COITM"
		, "EXT_UNION"."COMCU" AS "COMCU"
		, "EXT_UNION"."COLOCN" AS "COLOCN"
		, "EXT_UNION"."COLOTN" AS "COLOTN"
		, "EXT_UNION"."COLEDG" AS "COLEDG"
		, "EXT_UNION"."COITM_BK" AS "COITM_BK"
		, "EXT_UNION"."COMCU_BK" AS "COMCU_BK"
		, "EXT_UNION"."COLOCN_BK" AS "COLOCN_BK"
		, "EXT_UNION"."COLOTN_BK" AS "COLOTN_BK"
		, "EXT_UNION"."COLEDG_BK" AS "COLEDG_BK"
		, "EXT_UNION"."IBMCU_FK_ITEMBRANCH_COITM_BK" AS "IBMCU_FK_ITEMBRANCH_COITM_BK"
		, "EXT_UNION"."IBITM_FK_ITEMBRANCH_COITM_BK" AS "IBITM_FK_ITEMBRANCH_COITM_BK"
		, "EXT_UNION"."MCMCU_FK_BUSINESSUNITMASTER_COMCU_BK" AS "MCMCU_FK_BUSINESSUNITMASTER_COMCU_BK"
		, "EXT_UNION"."IMITM_FK_ITEMMASTER_COITM_BK" AS "IMITM_FK_ITEMMASTER_COITM_BK"
		, "EXT_UNION"."COLITM" AS "COLITM"
		, "EXT_UNION"."COAITM" AS "COAITM"
		, "EXT_UNION"."COLOTG" AS "COLOTG"
		, "EXT_UNION"."COUNCS" AS "COUNCS"
		, "EXT_UNION"."COCSPO" AS "COCSPO"
		, "EXT_UNION"."COCSIN" AS "COCSIN"
		, "EXT_UNION"."COURCD" AS "COURCD"
		, "EXT_UNION"."COURDT" AS "COURDT"
		, "EXT_UNION"."COURAT" AS "COURAT"
		, "EXT_UNION"."COURAB" AS "COURAB"
		, "EXT_UNION"."COURRF" AS "COURRF"
		, "EXT_UNION"."COUSER" AS "COUSER"
		, "EXT_UNION"."COPID" AS "COPID"
		, "EXT_UNION"."COJOBN" AS "COJOBN"
		, "EXT_UNION"."COUPMJ" AS "COUPMJ"
		, "EXT_UNION"."COTDAY" AS "COTDAY"
		, "EXT_UNION"."COCCFL" AS "COCCFL"
		, "EXT_UNION"."COCRCS" AS "COCRCS"
		, "EXT_UNION"."COOSTC" AS "COOSTC"
		, "EXT_UNION"."COSTOC" AS "COSTOC"
	FROM "EXT_UNION" "EXT_UNION"

) final 
where '{{ var("load_type") }}' = 'INCR' and '{{ var("source") }}' = 'JDEDWARDS'

UNION ALL

select * from (
	WITH "LOAD_INIT_DATA" AS 
	( 
		SELECT 
			  TO_CHAR('I' ) AS "JRN_FLAG"
			, TO_CHAR('S') AS "RECORD_TYPE"
			, COALESCE("INI_SRC"."COITM", CAST("MEX_INR_SRC"."KEY_ATTRIBUTE_FLOAT" AS FLOAT)) AS "COITM"
			, COALESCE("INI_SRC"."COMCU", CAST("MEX_INR_SRC"."KEY_ATTRIBUTE_VARCHAR" AS VARCHAR)) AS "COMCU"
			, COALESCE("INI_SRC"."COLOCN", CAST("MEX_INR_SRC"."KEY_ATTRIBUTE_VARCHAR" AS VARCHAR)) AS "COLOCN"
			, COALESCE("INI_SRC"."COLOTN", CAST("MEX_INR_SRC"."KEY_ATTRIBUTE_VARCHAR" AS VARCHAR)) AS "COLOTN"
			, COALESCE("INI_SRC"."COLEDG", CAST("MEX_INR_SRC"."KEY_ATTRIBUTE_VARCHAR" AS VARCHAR)) AS "COLEDG"
			, "INI_SRC"."COLITM" AS "COLITM"
			, "INI_SRC"."COAITM" AS "COAITM"
			, "INI_SRC"."COLOTG" AS "COLOTG"
			, "INI_SRC"."COUNCS" AS "COUNCS"
			, "INI_SRC"."COCSPO" AS "COCSPO"
			, "INI_SRC"."COCSIN" AS "COCSIN"
			, "INI_SRC"."COURCD" AS "COURCD"
			, "INI_SRC"."COURDT" AS "COURDT"
			, "INI_SRC"."COURAT" AS "COURAT"
			, "INI_SRC"."COURAB" AS "COURAB"
			, "INI_SRC"."COURRF" AS "COURRF"
			, "INI_SRC"."COUSER" AS "COUSER"
			, "INI_SRC"."COPID" AS "COPID"
			, "INI_SRC"."COJOBN" AS "COJOBN"
			, "INI_SRC"."COUPMJ" AS "COUPMJ"
			, "INI_SRC"."COTDAY" AS "COTDAY"
			, "INI_SRC"."COCCFL" AS "COCCFL"
			, "INI_SRC"."COCRCS" AS "COCRCS"
			, "INI_SRC"."COOSTC" AS "COOSTC"
			, "INI_SRC"."COSTOC" AS "COSTOC"
		FROM {{ source('JDEDWARDS_INI', 'F4105') }} "INI_SRC"
		INNER JOIN {{ source('JDEDWARDS_MTD', 'MTD_EXCEPTION_RECORDS') }} "MEX_INR_SRC" ON  "MEX_INR_SRC"."RECORD_TYPE" = 'N'
	)
	, "PREP_EXCEP" AS 
	( 
		SELECT 
			  "LOAD_INIT_DATA"."JRN_FLAG" AS "JRN_FLAG"
			, "LOAD_INIT_DATA"."RECORD_TYPE" AS "RECORD_TYPE"
			, NULL AS "LOAD_CYCLE_ID"
			, "LOAD_INIT_DATA"."COITM" AS "COITM"
			, "LOAD_INIT_DATA"."COMCU" AS "COMCU"
			, "LOAD_INIT_DATA"."COLOCN" AS "COLOCN"
			, "LOAD_INIT_DATA"."COLOTN" AS "COLOTN"
			, "LOAD_INIT_DATA"."COLEDG" AS "COLEDG"
			, "LOAD_INIT_DATA"."COLITM" AS "COLITM"
			, "LOAD_INIT_DATA"."COAITM" AS "COAITM"
			, "LOAD_INIT_DATA"."COLOTG" AS "COLOTG"
			, "LOAD_INIT_DATA"."COUNCS" AS "COUNCS"
			, "LOAD_INIT_DATA"."COCSPO" AS "COCSPO"
			, "LOAD_INIT_DATA"."COCSIN" AS "COCSIN"
			, "LOAD_INIT_DATA"."COURCD" AS "COURCD"
			, "LOAD_INIT_DATA"."COURDT" AS "COURDT"
			, "LOAD_INIT_DATA"."COURAT" AS "COURAT"
			, "LOAD_INIT_DATA"."COURAB" AS "COURAB"
			, "LOAD_INIT_DATA"."COURRF" AS "COURRF"
			, "LOAD_INIT_DATA"."COUSER" AS "COUSER"
			, "LOAD_INIT_DATA"."COPID" AS "COPID"
			, "LOAD_INIT_DATA"."COJOBN" AS "COJOBN"
			, "LOAD_INIT_DATA"."COUPMJ" AS "COUPMJ"
			, "LOAD_INIT_DATA"."COTDAY" AS "COTDAY"
			, "LOAD_INIT_DATA"."COCCFL" AS "COCCFL"
			, "LOAD_INIT_DATA"."COCRCS" AS "COCRCS"
			, "LOAD_INIT_DATA"."COOSTC" AS "COOSTC"
			, "LOAD_INIT_DATA"."COSTOC" AS "COSTOC"
		FROM "LOAD_INIT_DATA" "LOAD_INIT_DATA"
		UNION ALL 
		SELECT 
			  TO_CHAR('I' ) AS "JRN_FLAG"
			, "MEX_EXT_SRC"."RECORD_TYPE" AS "RECORD_TYPE"
			, "MEX_EXT_SRC"."LOAD_CYCLE_ID" ::integer AS "LOAD_CYCLE_ID"
			, CAST("MEX_EXT_SRC"."KEY_ATTRIBUTE_FLOAT" AS FLOAT) AS "COITM"
			, CAST("MEX_EXT_SRC"."KEY_ATTRIBUTE_VARCHAR" AS VARCHAR) AS "COMCU"
			, CAST("MEX_EXT_SRC"."KEY_ATTRIBUTE_VARCHAR" AS VARCHAR) AS "COLOCN"
			, CAST("MEX_EXT_SRC"."KEY_ATTRIBUTE_VARCHAR" AS VARCHAR) AS "COLOTN"
			, CAST("MEX_EXT_SRC"."KEY_ATTRIBUTE_VARCHAR" AS VARCHAR) AS "COLEDG"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_VARCHAR" AS VARCHAR) AS "COLITM"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_VARCHAR" AS VARCHAR) AS "COAITM"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_VARCHAR" AS VARCHAR) AS "COLOTG"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_FLOAT" AS FLOAT) AS "COUNCS"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_VARCHAR" AS VARCHAR) AS "COCSPO"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_VARCHAR" AS VARCHAR) AS "COCSIN"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_VARCHAR" AS VARCHAR) AS "COURCD"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_NUMBER" AS NUMBER) AS "COURDT"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_FLOAT" AS FLOAT) AS "COURAT"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_FLOAT" AS FLOAT) AS "COURAB"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_VARCHAR" AS VARCHAR) AS "COURRF"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_VARCHAR" AS VARCHAR) AS "COUSER"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_VARCHAR" AS VARCHAR) AS "COPID"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_VARCHAR" AS VARCHAR) AS "COJOBN"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_NUMBER" AS NUMBER) AS "COUPMJ"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_FLOAT" AS FLOAT) AS "COTDAY"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_VARCHAR" AS VARCHAR) AS "COCCFL"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_FLOAT" AS FLOAT) AS "COCRCS"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_FLOAT" AS FLOAT) AS "COOSTC"
			, CAST("MEX_EXT_SRC"."ATTRIBUTE_FLOAT" AS FLOAT) AS "COSTOC"
		FROM {{ source('JDEDWARDS_MTD', 'MTD_EXCEPTION_RECORDS') }} "MEX_EXT_SRC"
	)
	, "CALCULATE_BK" AS 
	( 
		SELECT 
			  COALESCE("PREP_EXCEP"."LOAD_CYCLE_ID","LCI_SRC"."LOAD_CYCLE_ID") AS "LOAD_CYCLE_ID"
			, "LCI_SRC"."LOAD_DATE" AS "LOAD_DATE"
			, "LCI_SRC"."LOAD_DATE" AS "CDC_TIMESTAMP"
			, "PREP_EXCEP"."JRN_FLAG" AS "JRN_FLAG"
			, "PREP_EXCEP"."RECORD_TYPE" AS "RECORD_TYPE"
			, "PREP_EXCEP"."COITM" AS "COITM"
			, "PREP_EXCEP"."COMCU" AS "COMCU"
			, "PREP_EXCEP"."COLOCN" AS "COLOCN"
			, "PREP_EXCEP"."COLOTN" AS "COLOTN"
			, "PREP_EXCEP"."COLEDG" AS "COLEDG"
			, COALESCE(UPPER( TO_CHAR("PREP_EXCEP"."COITM")),"MEX_SRC"."KEY_ATTRIBUTE_FLOAT") AS "COITM_BK"
			, COALESCE(REPLACE(TRIM("PREP_EXCEP"."COMCU"),'\#','\\' || '\#'),"MEX_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "COMCU_BK"
			, COALESCE(REPLACE(TRIM("PREP_EXCEP"."COLOCN"),'\#','\\' || '\#'),"MEX_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "COLOCN_BK"
			, COALESCE(REPLACE(TRIM("PREP_EXCEP"."COLOTN"),'\#','\\' || '\#'),"MEX_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "COLOTN_BK"
			, COALESCE(REPLACE(TRIM("PREP_EXCEP"."COLEDG"),'\#','\\' || '\#'),"MEX_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "COLEDG_BK"
			, REPLACE(TRIM("PREP_EXCEP"."COMCU"),'\#','\\' || '\#') AS "IBMCU_FK_ITEMBRANCH_COITM_BK"
			, UPPER( TO_CHAR("PREP_EXCEP"."COITM")) AS "IBITM_FK_ITEMBRANCH_COITM_BK"
			, REPLACE(TRIM("PREP_EXCEP"."COMCU"),'\#','\\' || '\#') AS "MCMCU_FK_BUSINESSUNITMASTER_COMCU_BK"
			, UPPER( TO_CHAR("PREP_EXCEP"."COITM")) AS "IMITM_FK_ITEMMASTER_COITM_BK"
			, "PREP_EXCEP"."COLITM" AS "COLITM"
			, "PREP_EXCEP"."COAITM" AS "COAITM"
			, "PREP_EXCEP"."COLOTG" AS "COLOTG"
			, "PREP_EXCEP"."COUNCS" AS "COUNCS"
			, "PREP_EXCEP"."COCSPO" AS "COCSPO"
			, "PREP_EXCEP"."COCSIN" AS "COCSIN"
			, "PREP_EXCEP"."COURCD" AS "COURCD"
			, "PREP_EXCEP"."COURDT" AS "COURDT"
			, "PREP_EXCEP"."COURAT" AS "COURAT"
			, "PREP_EXCEP"."COURAB" AS "COURAB"
			, "PREP_EXCEP"."COURRF" AS "COURRF"
			, "PREP_EXCEP"."COUSER" AS "COUSER"
			, "PREP_EXCEP"."COPID" AS "COPID"
			, "PREP_EXCEP"."COJOBN" AS "COJOBN"
			, "PREP_EXCEP"."COUPMJ" AS "COUPMJ"
			, "PREP_EXCEP"."COTDAY" AS "COTDAY"
			, "PREP_EXCEP"."COCCFL" AS "COCCFL"
			, "PREP_EXCEP"."COCRCS" AS "COCRCS"
			, "PREP_EXCEP"."COOSTC" AS "COOSTC"
			, "PREP_EXCEP"."COSTOC" AS "COSTOC"
		FROM "PREP_EXCEP" "PREP_EXCEP"
		INNER JOIN {{ source('JDEDWARDS_MTD', 'LOAD_CYCLE_INFO') }} "LCI_SRC" ON  1 = 1
		INNER JOIN {{ source('JDEDWARDS_MTD', 'MTD_EXCEPTION_RECORDS') }} "MEX_SRC" ON  1 = 1
		WHERE  "MEX_SRC"."RECORD_TYPE" = 'N'
	)
	SELECT 
		  "CALCULATE_BK"."LOAD_CYCLE_ID" AS "LOAD_CYCLE_ID"
		, "CALCULATE_BK"."LOAD_DATE" AS "LOAD_DATE"
		, "CALCULATE_BK"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
		, "CALCULATE_BK"."JRN_FLAG" AS "JRN_FLAG"
		, "CALCULATE_BK"."RECORD_TYPE" AS "RECORD_TYPE"
		, "CALCULATE_BK"."COITM" AS "COITM"
		, "CALCULATE_BK"."COMCU" AS "COMCU"
		, "CALCULATE_BK"."COLOCN" AS "COLOCN"
		, "CALCULATE_BK"."COLOTN" AS "COLOTN"
		, "CALCULATE_BK"."COLEDG" AS "COLEDG"
		, "CALCULATE_BK"."COITM_BK" AS "COITM_BK"
		, "CALCULATE_BK"."COMCU_BK" AS "COMCU_BK"
		, "CALCULATE_BK"."COLOCN_BK" AS "COLOCN_BK"
		, "CALCULATE_BK"."COLOTN_BK" AS "COLOTN_BK"
		, "CALCULATE_BK"."COLEDG_BK" AS "COLEDG_BK"
		, "CALCULATE_BK"."IBMCU_FK_ITEMBRANCH_COITM_BK" AS "IBMCU_FK_ITEMBRANCH_COITM_BK"
		, "CALCULATE_BK"."IBITM_FK_ITEMBRANCH_COITM_BK" AS "IBITM_FK_ITEMBRANCH_COITM_BK"
		, "CALCULATE_BK"."MCMCU_FK_BUSINESSUNITMASTER_COMCU_BK" AS "MCMCU_FK_BUSINESSUNITMASTER_COMCU_BK"
		, "CALCULATE_BK"."IMITM_FK_ITEMMASTER_COITM_BK" AS "IMITM_FK_ITEMMASTER_COITM_BK"
		, "CALCULATE_BK"."COLITM" AS "COLITM"
		, "CALCULATE_BK"."COAITM" AS "COAITM"
		, "CALCULATE_BK"."COLOTG" AS "COLOTG"
		, "CALCULATE_BK"."COUNCS" AS "COUNCS"
		, "CALCULATE_BK"."COCSPO" AS "COCSPO"
		, "CALCULATE_BK"."COCSIN" AS "COCSIN"
		, "CALCULATE_BK"."COURCD" AS "COURCD"
		, "CALCULATE_BK"."COURDT" AS "COURDT"
		, "CALCULATE_BK"."COURAT" AS "COURAT"
		, "CALCULATE_BK"."COURAB" AS "COURAB"
		, "CALCULATE_BK"."COURRF" AS "COURRF"
		, "CALCULATE_BK"."COUSER" AS "COUSER"
		, "CALCULATE_BK"."COPID" AS "COPID"
		, "CALCULATE_BK"."COJOBN" AS "COJOBN"
		, "CALCULATE_BK"."COUPMJ" AS "COUPMJ"
		, "CALCULATE_BK"."COTDAY" AS "COTDAY"
		, "CALCULATE_BK"."COCCFL" AS "COCCFL"
		, "CALCULATE_BK"."COCRCS" AS "COCRCS"
		, "CALCULATE_BK"."COOSTC" AS "COOSTC"
		, "CALCULATE_BK"."COSTOC" AS "COSTOC"
	FROM "CALCULATE_BK" "CALCULATE_BK"

) final 
where '{{ var("load_type") }}' = 'INIT' and '{{ var("source") }}' = 'JDEDWARDS'