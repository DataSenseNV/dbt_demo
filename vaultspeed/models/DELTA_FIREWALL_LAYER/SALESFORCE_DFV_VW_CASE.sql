{{
	config(
		materialized='view',
		alias='VW_CASE',
		schema='SALESFORCE_DFV',
		tags=['view', 'SALESFORCE', 'SRC_SALESFORCE_CASE_TDFV_INCR']
	)
}}
	WITH "DELTA_WINDOW" AS 
	( 
		SELECT 
			  "LWT_SRC"."FMC_BEGIN_LW_TIMESTAMP" AS "FMC_BEGIN_LW_TIMESTAMP"
			, "LWT_SRC"."FMC_END_LW_TIMESTAMP" AS "FMC_END_LW_TIMESTAMP"
		FROM {{ source('SALESFORCE_MTD', 'FMC_LOADING_WINDOW_TABLE') }} "LWT_SRC"
	)
	, "DELTA_VIEW_FILTER" AS 
	( 
		SELECT 
			  "CDC_SRC"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
			, "CDC_SRC"."JRN_FLAG" AS "JRN_FLAG"
			, TO_CHAR('S' ) AS "RECORD_TYPE"
			, "CDC_SRC"."ID" AS "ID"
			, "CDC_SRC"."CONTACTID" AS "CONTACTID"
			, "CDC_SRC"."ACCOUNTID" AS "ACCOUNTID"
			, "CDC_SRC"."ASSETID" AS "ASSETID"
			, "CDC_SRC"."PARENTID" AS "PARENTID"
			, "CDC_SRC"."CREATEDBYID" AS "CREATEDBYID"
			, "CDC_SRC"."LASTMODIFIEDBYID" AS "LASTMODIFIEDBYID"
			, "CDC_SRC"."ISDELETED" AS "ISDELETED"
			, "CDC_SRC"."MASTERRECORDID" AS "MASTERRECORDID"
			, "CDC_SRC"."CASENUMBER" AS "CASENUMBER"
			, "CDC_SRC"."SOURCEID" AS "SOURCEID"
			, "CDC_SRC"."BUSINESSHOURSID" AS "BUSINESSHOURSID"
			, "CDC_SRC"."SUPPLIEDNAME" AS "SUPPLIEDNAME"
			, "CDC_SRC"."SUPPLIEDEMAIL" AS "SUPPLIEDEMAIL"
			, "CDC_SRC"."SUPPLIEDPHONE" AS "SUPPLIEDPHONE"
			, "CDC_SRC"."SUPPLIEDCOMPANY" AS "SUPPLIEDCOMPANY"
			, "CDC_SRC"."TYPE" AS "TYPE"
			, "CDC_SRC"."STATUS" AS "STATUS"
			, "CDC_SRC"."REASON" AS "REASON"
			, "CDC_SRC"."ORIGIN" AS "ORIGIN"
			, "CDC_SRC"."SUBJECT" AS "SUBJECT"
			, "CDC_SRC"."PRIORITY" AS "PRIORITY"
			, "CDC_SRC"."DESCRIPTION" AS "DESCRIPTION"
			, "CDC_SRC"."ISCLOSED" AS "ISCLOSED"
			, "CDC_SRC"."CLOSEDDATE" AS "CLOSEDDATE"
			, "CDC_SRC"."ISESCALATED" AS "ISESCALATED"
			, "CDC_SRC"."OWNERID" AS "OWNERID"
			, "CDC_SRC"."ISCLOSEDONCREATE" AS "ISCLOSEDONCREATE"
			, "CDC_SRC"."CREATEDDATE" AS "CREATEDDATE"
			, "CDC_SRC"."LASTMODIFIEDDATE" AS "LASTMODIFIEDDATE"
			, "CDC_SRC"."SYSTEMMODSTAMP" AS "SYSTEMMODSTAMP"
			, "CDC_SRC"."EVENTSPROCESSEDDATE" AS "EVENTSPROCESSEDDATE"
			, "CDC_SRC"."CSAT__C" AS "CSAT__C"
			, "CDC_SRC"."CASE_EXTERNALID__C" AS "CASE_EXTERNALID__C"
			, "CDC_SRC"."FCR__C" AS "FCR__C"
			, "CDC_SRC"."PRODUCT_FAMILY_KB__C" AS "PRODUCT_FAMILY_KB__C"
			, "CDC_SRC"."SLAVIOLATION__C" AS "SLAVIOLATION__C"
			, "CDC_SRC"."SLA_TYPE__C" AS "SLA_TYPE__C"
		FROM {{ source('SALESFORCE_CDC', 'CDC_CASE') }} "CDC_SRC"
		INNER JOIN "DELTA_WINDOW" "DELTA_WINDOW" ON  1 = 1
		WHERE  "CDC_SRC"."CDC_TIMESTAMP" > "DELTA_WINDOW"."FMC_BEGIN_LW_TIMESTAMP" AND "CDC_SRC"."CDC_TIMESTAMP" <= "DELTA_WINDOW"."FMC_END_LW_TIMESTAMP"
	)
	, "DELTA_VIEW" AS 
	( 
		SELECT 
			  "DELTA_VIEW_FILTER"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
			, "DELTA_VIEW_FILTER"."JRN_FLAG" AS "JRN_FLAG"
			, "DELTA_VIEW_FILTER"."RECORD_TYPE" AS "RECORD_TYPE"
			, "DELTA_VIEW_FILTER"."ID" AS "ID"
			, "DELTA_VIEW_FILTER"."CONTACTID" AS "CONTACTID"
			, "DELTA_VIEW_FILTER"."ACCOUNTID" AS "ACCOUNTID"
			, "DELTA_VIEW_FILTER"."ASSETID" AS "ASSETID"
			, "DELTA_VIEW_FILTER"."PARENTID" AS "PARENTID"
			, "DELTA_VIEW_FILTER"."CREATEDBYID" AS "CREATEDBYID"
			, "DELTA_VIEW_FILTER"."LASTMODIFIEDBYID" AS "LASTMODIFIEDBYID"
			, "DELTA_VIEW_FILTER"."ISDELETED" AS "ISDELETED"
			, "DELTA_VIEW_FILTER"."MASTERRECORDID" AS "MASTERRECORDID"
			, "DELTA_VIEW_FILTER"."CASENUMBER" AS "CASENUMBER"
			, "DELTA_VIEW_FILTER"."SOURCEID" AS "SOURCEID"
			, "DELTA_VIEW_FILTER"."BUSINESSHOURSID" AS "BUSINESSHOURSID"
			, "DELTA_VIEW_FILTER"."SUPPLIEDNAME" AS "SUPPLIEDNAME"
			, "DELTA_VIEW_FILTER"."SUPPLIEDEMAIL" AS "SUPPLIEDEMAIL"
			, "DELTA_VIEW_FILTER"."SUPPLIEDPHONE" AS "SUPPLIEDPHONE"
			, "DELTA_VIEW_FILTER"."SUPPLIEDCOMPANY" AS "SUPPLIEDCOMPANY"
			, "DELTA_VIEW_FILTER"."TYPE" AS "TYPE"
			, "DELTA_VIEW_FILTER"."STATUS" AS "STATUS"
			, "DELTA_VIEW_FILTER"."REASON" AS "REASON"
			, "DELTA_VIEW_FILTER"."ORIGIN" AS "ORIGIN"
			, "DELTA_VIEW_FILTER"."SUBJECT" AS "SUBJECT"
			, "DELTA_VIEW_FILTER"."PRIORITY" AS "PRIORITY"
			, "DELTA_VIEW_FILTER"."DESCRIPTION" AS "DESCRIPTION"
			, "DELTA_VIEW_FILTER"."ISCLOSED" AS "ISCLOSED"
			, "DELTA_VIEW_FILTER"."CLOSEDDATE" AS "CLOSEDDATE"
			, "DELTA_VIEW_FILTER"."ISESCALATED" AS "ISESCALATED"
			, "DELTA_VIEW_FILTER"."OWNERID" AS "OWNERID"
			, "DELTA_VIEW_FILTER"."ISCLOSEDONCREATE" AS "ISCLOSEDONCREATE"
			, "DELTA_VIEW_FILTER"."CREATEDDATE" AS "CREATEDDATE"
			, "DELTA_VIEW_FILTER"."LASTMODIFIEDDATE" AS "LASTMODIFIEDDATE"
			, "DELTA_VIEW_FILTER"."SYSTEMMODSTAMP" AS "SYSTEMMODSTAMP"
			, "DELTA_VIEW_FILTER"."EVENTSPROCESSEDDATE" AS "EVENTSPROCESSEDDATE"
			, "DELTA_VIEW_FILTER"."CSAT__C" AS "CSAT__C"
			, "DELTA_VIEW_FILTER"."CASE_EXTERNALID__C" AS "CASE_EXTERNALID__C"
			, "DELTA_VIEW_FILTER"."FCR__C" AS "FCR__C"
			, "DELTA_VIEW_FILTER"."PRODUCT_FAMILY_KB__C" AS "PRODUCT_FAMILY_KB__C"
			, "DELTA_VIEW_FILTER"."SLAVIOLATION__C" AS "SLAVIOLATION__C"
			, "DELTA_VIEW_FILTER"."SLA_TYPE__C" AS "SLA_TYPE__C"
		FROM "DELTA_VIEW_FILTER" "DELTA_VIEW_FILTER"
	)
	, "PREPJOINBK" AS 
	( 
		SELECT 
			  "DELTA_VIEW"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
			, "DELTA_VIEW"."JRN_FLAG" AS "JRN_FLAG"
			, "DELTA_VIEW"."RECORD_TYPE" AS "RECORD_TYPE"
			, COALESCE("DELTA_VIEW"."ID","MEX_BK_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "ID"
			, COALESCE("DELTA_VIEW"."PARENTID","MEX_BK_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "PARENTID"
			, COALESCE("DELTA_VIEW"."CREATEDBYID","MEX_BK_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "CREATEDBYID"
			, COALESCE("DELTA_VIEW"."LASTMODIFIEDBYID","MEX_BK_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "LASTMODIFIEDBYID"
			, COALESCE("DELTA_VIEW"."ACCOUNTID","MEX_BK_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "ACCOUNTID"
			, COALESCE("DELTA_VIEW"."CONTACTID","MEX_BK_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "CONTACTID"
			, COALESCE("DELTA_VIEW"."ASSETID","MEX_BK_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "ASSETID"
			, "DELTA_VIEW"."ISDELETED" AS "ISDELETED"
			, "DELTA_VIEW"."MASTERRECORDID" AS "MASTERRECORDID"
			, "DELTA_VIEW"."CASENUMBER" AS "CASENUMBER"
			, "DELTA_VIEW"."SOURCEID" AS "SOURCEID"
			, "DELTA_VIEW"."BUSINESSHOURSID" AS "BUSINESSHOURSID"
			, "DELTA_VIEW"."SUPPLIEDNAME" AS "SUPPLIEDNAME"
			, "DELTA_VIEW"."SUPPLIEDEMAIL" AS "SUPPLIEDEMAIL"
			, "DELTA_VIEW"."SUPPLIEDPHONE" AS "SUPPLIEDPHONE"
			, "DELTA_VIEW"."SUPPLIEDCOMPANY" AS "SUPPLIEDCOMPANY"
			, "DELTA_VIEW"."TYPE" AS "TYPE"
			, "DELTA_VIEW"."STATUS" AS "STATUS"
			, "DELTA_VIEW"."REASON" AS "REASON"
			, "DELTA_VIEW"."ORIGIN" AS "ORIGIN"
			, "DELTA_VIEW"."SUBJECT" AS "SUBJECT"
			, "DELTA_VIEW"."PRIORITY" AS "PRIORITY"
			, "DELTA_VIEW"."DESCRIPTION" AS "DESCRIPTION"
			, "DELTA_VIEW"."ISCLOSED" AS "ISCLOSED"
			, "DELTA_VIEW"."CLOSEDDATE" AS "CLOSEDDATE"
			, "DELTA_VIEW"."ISESCALATED" AS "ISESCALATED"
			, "DELTA_VIEW"."OWNERID" AS "OWNERID"
			, "DELTA_VIEW"."ISCLOSEDONCREATE" AS "ISCLOSEDONCREATE"
			, "DELTA_VIEW"."CREATEDDATE" AS "CREATEDDATE"
			, "DELTA_VIEW"."LASTMODIFIEDDATE" AS "LASTMODIFIEDDATE"
			, "DELTA_VIEW"."SYSTEMMODSTAMP" AS "SYSTEMMODSTAMP"
			, "DELTA_VIEW"."EVENTSPROCESSEDDATE" AS "EVENTSPROCESSEDDATE"
			, "DELTA_VIEW"."CSAT__C" AS "CSAT__C"
			, "DELTA_VIEW"."CASE_EXTERNALID__C" AS "CASE_EXTERNALID__C"
			, "DELTA_VIEW"."FCR__C" AS "FCR__C"
			, "DELTA_VIEW"."PRODUCT_FAMILY_KB__C" AS "PRODUCT_FAMILY_KB__C"
			, "DELTA_VIEW"."SLAVIOLATION__C" AS "SLAVIOLATION__C"
			, "DELTA_VIEW"."SLA_TYPE__C" AS "SLA_TYPE__C"
		FROM "DELTA_VIEW" "DELTA_VIEW"
		INNER JOIN {{ source('SALESFORCE_MTD', 'MTD_EXCEPTION_RECORDS') }} "MEX_BK_SRC" ON  1 = 1
		WHERE  "MEX_BK_SRC"."RECORD_TYPE" = 'N'
	)
	SELECT 
		  "PREPJOINBK"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
		, "PREPJOINBK"."JRN_FLAG" AS "JRN_FLAG"
		, "PREPJOINBK"."RECORD_TYPE" AS "RECORD_TYPE"
		, "PREPJOINBK"."ID" AS "ID"
		, "PREPJOINBK"."CONTACTID" AS "CONTACTID"
		, "PREPJOINBK"."ACCOUNTID" AS "ACCOUNTID"
		, "PREPJOINBK"."ASSETID" AS "ASSETID"
		, "PREPJOINBK"."PARENTID" AS "PARENTID"
		, "PREPJOINBK"."CREATEDBYID" AS "CREATEDBYID"
		, "PREPJOINBK"."LASTMODIFIEDBYID" AS "LASTMODIFIEDBYID"
		, "PREPJOINBK"."ISDELETED" AS "ISDELETED"
		, "PREPJOINBK"."MASTERRECORDID" AS "MASTERRECORDID"
		, "PREPJOINBK"."CASENUMBER" AS "CASENUMBER"
		, "PREPJOINBK"."SOURCEID" AS "SOURCEID"
		, "PREPJOINBK"."BUSINESSHOURSID" AS "BUSINESSHOURSID"
		, "PREPJOINBK"."SUPPLIEDNAME" AS "SUPPLIEDNAME"
		, "PREPJOINBK"."SUPPLIEDEMAIL" AS "SUPPLIEDEMAIL"
		, "PREPJOINBK"."SUPPLIEDPHONE" AS "SUPPLIEDPHONE"
		, "PREPJOINBK"."SUPPLIEDCOMPANY" AS "SUPPLIEDCOMPANY"
		, "PREPJOINBK"."TYPE" AS "TYPE"
		, "PREPJOINBK"."STATUS" AS "STATUS"
		, "PREPJOINBK"."REASON" AS "REASON"
		, "PREPJOINBK"."ORIGIN" AS "ORIGIN"
		, "PREPJOINBK"."SUBJECT" AS "SUBJECT"
		, "PREPJOINBK"."PRIORITY" AS "PRIORITY"
		, "PREPJOINBK"."DESCRIPTION" AS "DESCRIPTION"
		, "PREPJOINBK"."ISCLOSED" AS "ISCLOSED"
		, "PREPJOINBK"."CLOSEDDATE" AS "CLOSEDDATE"
		, "PREPJOINBK"."ISESCALATED" AS "ISESCALATED"
		, "PREPJOINBK"."OWNERID" AS "OWNERID"
		, "PREPJOINBK"."ISCLOSEDONCREATE" AS "ISCLOSEDONCREATE"
		, "PREPJOINBK"."CREATEDDATE" AS "CREATEDDATE"
		, "PREPJOINBK"."LASTMODIFIEDDATE" AS "LASTMODIFIEDDATE"
		, "PREPJOINBK"."SYSTEMMODSTAMP" AS "SYSTEMMODSTAMP"
		, "PREPJOINBK"."EVENTSPROCESSEDDATE" AS "EVENTSPROCESSEDDATE"
		, "PREPJOINBK"."CSAT__C" AS "CSAT__C"
		, "PREPJOINBK"."CASE_EXTERNALID__C" AS "CASE_EXTERNALID__C"
		, "PREPJOINBK"."FCR__C" AS "FCR__C"
		, "PREPJOINBK"."PRODUCT_FAMILY_KB__C" AS "PRODUCT_FAMILY_KB__C"
		, "PREPJOINBK"."SLAVIOLATION__C" AS "SLAVIOLATION__C"
		, "PREPJOINBK"."SLA_TYPE__C" AS "SLA_TYPE__C"
	FROM "PREPJOINBK" "PREPJOINBK"
