{{
	config(
		materialized='view',
		alias='VW_F4106',
		schema='JDEDWARDS_DFV',
		tags=['view', 'JDEDWARDS', 'SRC_JDE_ITEMPRICE_TDFV_INCR']
	)
}}
	WITH "DELTA_WINDOW" AS 
	( 
		SELECT 
			  "LWT_SRC"."FMC_BEGIN_LW_TIMESTAMP" AS "FMC_BEGIN_LW_TIMESTAMP"
			, "LWT_SRC"."FMC_END_LW_TIMESTAMP" AS "FMC_END_LW_TIMESTAMP"
		FROM {{ source('JDEDWARDS_MTD', 'FMC_LOADING_WINDOW_TABLE') }} "LWT_SRC"
	)
	, "DELTA_VIEW_FILTER" AS 
	( 
		SELECT 
			  "CDC_SRC"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
			, "CDC_SRC"."JRN_FLAG" AS "JRN_FLAG"
			, TO_CHAR('S' ) AS "RECORD_TYPE"
			, "CDC_SRC"."BPITM" AS "BPITM"
			, "CDC_SRC"."BPMCU" AS "BPMCU"
			, "CDC_SRC"."BPLOCN" AS "BPLOCN"
			, "CDC_SRC"."BPLOTN" AS "BPLOTN"
			, "CDC_SRC"."BPAN8" AS "BPAN8"
			, "CDC_SRC"."BPIGID" AS "BPIGID"
			, "CDC_SRC"."BPCGID" AS "BPCGID"
			, "CDC_SRC"."BPLOTG" AS "BPLOTG"
			, "CDC_SRC"."BPFRMP" AS "BPFRMP"
			, "CDC_SRC"."BPCRCD" AS "BPCRCD"
			, "CDC_SRC"."BPUOM" AS "BPUOM"
			, "CDC_SRC"."BPEXDJ" AS "BPEXDJ"
			, "CDC_SRC"."BPUPMJ" AS "BPUPMJ"
			, "CDC_SRC"."BPTDAY" AS "BPTDAY"
			, "CDC_SRC"."BPLEDG" AS "BPLEDG"
			, "CDC_SRC"."BPLITM" AS "BPLITM"
			, "CDC_SRC"."BPAITM" AS "BPAITM"
			, "CDC_SRC"."BPEFTJ" AS "BPEFTJ"
			, "CDC_SRC"."BPUPRC" AS "BPUPRC"
			, "CDC_SRC"."BPACRD" AS "BPACRD"
			, "CDC_SRC"."BPBSCD" AS "BPBSCD"
			, "CDC_SRC"."BPFVTR" AS "BPFVTR"
			, "CDC_SRC"."BPFRMN" AS "BPFRMN"
			, "CDC_SRC"."BPURCD" AS "BPURCD"
			, "CDC_SRC"."BPURDT" AS "BPURDT"
			, "CDC_SRC"."BPURAT" AS "BPURAT"
			, "CDC_SRC"."BPURAB" AS "BPURAB"
			, "CDC_SRC"."BPURRF" AS "BPURRF"
			, "CDC_SRC"."BPAPRS" AS "BPAPRS"
			, "CDC_SRC"."BPUSER" AS "BPUSER"
			, "CDC_SRC"."BPPID" AS "BPPID"
			, "CDC_SRC"."BPJOBN" AS "BPJOBN"
		FROM {{ source('JDEDWARDS_CDC', 'CDC_F4106') }} "CDC_SRC"
		INNER JOIN "DELTA_WINDOW" "DELTA_WINDOW" ON  1 = 1
		WHERE  "CDC_SRC"."CDC_TIMESTAMP" > "DELTA_WINDOW"."FMC_BEGIN_LW_TIMESTAMP" AND "CDC_SRC"."CDC_TIMESTAMP" <= "DELTA_WINDOW"."FMC_END_LW_TIMESTAMP"
	)
	, "DELTA_VIEW" AS 
	( 
		SELECT 
			  "DELTA_VIEW_FILTER"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
			, "DELTA_VIEW_FILTER"."JRN_FLAG" AS "JRN_FLAG"
			, "DELTA_VIEW_FILTER"."RECORD_TYPE" AS "RECORD_TYPE"
			, "DELTA_VIEW_FILTER"."BPITM" AS "BPITM"
			, "DELTA_VIEW_FILTER"."BPMCU" AS "BPMCU"
			, "DELTA_VIEW_FILTER"."BPLOCN" AS "BPLOCN"
			, "DELTA_VIEW_FILTER"."BPLOTN" AS "BPLOTN"
			, "DELTA_VIEW_FILTER"."BPAN8" AS "BPAN8"
			, "DELTA_VIEW_FILTER"."BPIGID" AS "BPIGID"
			, "DELTA_VIEW_FILTER"."BPCGID" AS "BPCGID"
			, "DELTA_VIEW_FILTER"."BPLOTG" AS "BPLOTG"
			, "DELTA_VIEW_FILTER"."BPFRMP" AS "BPFRMP"
			, "DELTA_VIEW_FILTER"."BPCRCD" AS "BPCRCD"
			, "DELTA_VIEW_FILTER"."BPUOM" AS "BPUOM"
			, "DELTA_VIEW_FILTER"."BPEXDJ" AS "BPEXDJ"
			, "DELTA_VIEW_FILTER"."BPUPMJ" AS "BPUPMJ"
			, "DELTA_VIEW_FILTER"."BPTDAY" AS "BPTDAY"
			, "DELTA_VIEW_FILTER"."BPLEDG" AS "BPLEDG"
			, "DELTA_VIEW_FILTER"."BPLITM" AS "BPLITM"
			, "DELTA_VIEW_FILTER"."BPAITM" AS "BPAITM"
			, "DELTA_VIEW_FILTER"."BPEFTJ" AS "BPEFTJ"
			, "DELTA_VIEW_FILTER"."BPUPRC" AS "BPUPRC"
			, "DELTA_VIEW_FILTER"."BPACRD" AS "BPACRD"
			, "DELTA_VIEW_FILTER"."BPBSCD" AS "BPBSCD"
			, "DELTA_VIEW_FILTER"."BPFVTR" AS "BPFVTR"
			, "DELTA_VIEW_FILTER"."BPFRMN" AS "BPFRMN"
			, "DELTA_VIEW_FILTER"."BPURCD" AS "BPURCD"
			, "DELTA_VIEW_FILTER"."BPURDT" AS "BPURDT"
			, "DELTA_VIEW_FILTER"."BPURAT" AS "BPURAT"
			, "DELTA_VIEW_FILTER"."BPURAB" AS "BPURAB"
			, "DELTA_VIEW_FILTER"."BPURRF" AS "BPURRF"
			, "DELTA_VIEW_FILTER"."BPAPRS" AS "BPAPRS"
			, "DELTA_VIEW_FILTER"."BPUSER" AS "BPUSER"
			, "DELTA_VIEW_FILTER"."BPPID" AS "BPPID"
			, "DELTA_VIEW_FILTER"."BPJOBN" AS "BPJOBN"
		FROM "DELTA_VIEW_FILTER" "DELTA_VIEW_FILTER"
	)
	, "PREPJOINBK" AS 
	( 
		SELECT 
			  "DELTA_VIEW"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
			, "DELTA_VIEW"."JRN_FLAG" AS "JRN_FLAG"
			, "DELTA_VIEW"."RECORD_TYPE" AS "RECORD_TYPE"
			, COALESCE("DELTA_VIEW"."BPITM", CAST("MEX_BK_SRC"."KEY_ATTRIBUTE_FLOAT" AS FLOAT)) AS "BPITM"
			, COALESCE("DELTA_VIEW"."BPMCU","MEX_BK_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "BPMCU"
			, COALESCE("DELTA_VIEW"."BPLOCN","MEX_BK_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "BPLOCN"
			, COALESCE("DELTA_VIEW"."BPLOTN","MEX_BK_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "BPLOTN"
			, COALESCE("DELTA_VIEW"."BPAN8", CAST("MEX_BK_SRC"."KEY_ATTRIBUTE_FLOAT" AS FLOAT)) AS "BPAN8"
			, COALESCE("DELTA_VIEW"."BPIGID", CAST("MEX_BK_SRC"."KEY_ATTRIBUTE_FLOAT" AS FLOAT)) AS "BPIGID"
			, COALESCE("DELTA_VIEW"."BPCGID", CAST("MEX_BK_SRC"."KEY_ATTRIBUTE_FLOAT" AS FLOAT)) AS "BPCGID"
			, COALESCE("DELTA_VIEW"."BPLOTG","MEX_BK_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "BPLOTG"
			, COALESCE("DELTA_VIEW"."BPFRMP", CAST("MEX_BK_SRC"."KEY_ATTRIBUTE_FLOAT" AS FLOAT)) AS "BPFRMP"
			, COALESCE("DELTA_VIEW"."BPCRCD","MEX_BK_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "BPCRCD"
			, COALESCE("DELTA_VIEW"."BPUOM","MEX_BK_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "BPUOM"
			, COALESCE("DELTA_VIEW"."BPEXDJ", CAST("MEX_BK_SRC"."KEY_ATTRIBUTE_NUMBER" AS NUMBER)) AS "BPEXDJ"
			, COALESCE("DELTA_VIEW"."BPUPMJ", CAST("MEX_BK_SRC"."KEY_ATTRIBUTE_NUMBER" AS NUMBER)) AS "BPUPMJ"
			, COALESCE("DELTA_VIEW"."BPTDAY", CAST("MEX_BK_SRC"."KEY_ATTRIBUTE_FLOAT" AS FLOAT)) AS "BPTDAY"
			, COALESCE("DELTA_VIEW"."BPLEDG","MEX_BK_SRC"."KEY_ATTRIBUTE_VARCHAR") AS "BPLEDG"
			, "DELTA_VIEW"."BPLITM" AS "BPLITM"
			, "DELTA_VIEW"."BPAITM" AS "BPAITM"
			, "DELTA_VIEW"."BPEFTJ" AS "BPEFTJ"
			, "DELTA_VIEW"."BPUPRC" AS "BPUPRC"
			, "DELTA_VIEW"."BPACRD" AS "BPACRD"
			, "DELTA_VIEW"."BPBSCD" AS "BPBSCD"
			, "DELTA_VIEW"."BPFVTR" AS "BPFVTR"
			, "DELTA_VIEW"."BPFRMN" AS "BPFRMN"
			, "DELTA_VIEW"."BPURCD" AS "BPURCD"
			, "DELTA_VIEW"."BPURDT" AS "BPURDT"
			, "DELTA_VIEW"."BPURAT" AS "BPURAT"
			, "DELTA_VIEW"."BPURAB" AS "BPURAB"
			, "DELTA_VIEW"."BPURRF" AS "BPURRF"
			, "DELTA_VIEW"."BPAPRS" AS "BPAPRS"
			, "DELTA_VIEW"."BPUSER" AS "BPUSER"
			, "DELTA_VIEW"."BPPID" AS "BPPID"
			, "DELTA_VIEW"."BPJOBN" AS "BPJOBN"
		FROM "DELTA_VIEW" "DELTA_VIEW"
		INNER JOIN {{ source('JDEDWARDS_MTD', 'MTD_EXCEPTION_RECORDS') }} "MEX_BK_SRC" ON  1 = 1
		WHERE  "MEX_BK_SRC"."RECORD_TYPE" = 'N'
	)
	SELECT 
		  "PREPJOINBK"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
		, "PREPJOINBK"."JRN_FLAG" AS "JRN_FLAG"
		, "PREPJOINBK"."RECORD_TYPE" AS "RECORD_TYPE"
		, "PREPJOINBK"."BPITM" AS "BPITM"
		, "PREPJOINBK"."BPMCU" AS "BPMCU"
		, "PREPJOINBK"."BPLOCN" AS "BPLOCN"
		, "PREPJOINBK"."BPLOTN" AS "BPLOTN"
		, "PREPJOINBK"."BPAN8" AS "BPAN8"
		, "PREPJOINBK"."BPIGID" AS "BPIGID"
		, "PREPJOINBK"."BPCGID" AS "BPCGID"
		, "PREPJOINBK"."BPLOTG" AS "BPLOTG"
		, "PREPJOINBK"."BPFRMP" AS "BPFRMP"
		, "PREPJOINBK"."BPCRCD" AS "BPCRCD"
		, "PREPJOINBK"."BPUOM" AS "BPUOM"
		, "PREPJOINBK"."BPEXDJ" AS "BPEXDJ"
		, "PREPJOINBK"."BPUPMJ" AS "BPUPMJ"
		, "PREPJOINBK"."BPTDAY" AS "BPTDAY"
		, "PREPJOINBK"."BPLEDG" AS "BPLEDG"
		, "PREPJOINBK"."BPLITM" AS "BPLITM"
		, "PREPJOINBK"."BPAITM" AS "BPAITM"
		, "PREPJOINBK"."BPEFTJ" AS "BPEFTJ"
		, "PREPJOINBK"."BPUPRC" AS "BPUPRC"
		, "PREPJOINBK"."BPACRD" AS "BPACRD"
		, "PREPJOINBK"."BPBSCD" AS "BPBSCD"
		, "PREPJOINBK"."BPFVTR" AS "BPFVTR"
		, "PREPJOINBK"."BPFRMN" AS "BPFRMN"
		, "PREPJOINBK"."BPURCD" AS "BPURCD"
		, "PREPJOINBK"."BPURDT" AS "BPURDT"
		, "PREPJOINBK"."BPURAT" AS "BPURAT"
		, "PREPJOINBK"."BPURAB" AS "BPURAB"
		, "PREPJOINBK"."BPURRF" AS "BPURRF"
		, "PREPJOINBK"."BPAPRS" AS "BPAPRS"
		, "PREPJOINBK"."BPUSER" AS "BPUSER"
		, "PREPJOINBK"."BPPID" AS "BPPID"
		, "PREPJOINBK"."BPJOBN" AS "BPJOBN"
	FROM "PREPJOINBK" "PREPJOINBK"
