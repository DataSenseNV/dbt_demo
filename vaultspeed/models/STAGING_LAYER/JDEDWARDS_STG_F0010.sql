{{
	config(
		materialized='incremental',
		pre_hook= [
			'{% if var("load_type") == "INCR" and var("source") == "JDEDWARDS" %} TRUNCATE TABLE {{ this }}; {% endif %}',
			'{% if var("load_type") == "INIT" and var("source") == "JDEDWARDS" %} TRUNCATE TABLE {{ this }}; {% endif %}'
		],
		alias='F0010',
		schema='JDEDWARDS_STG',
		tags=['JDEDWARDS', 'STG_JDE_COMPANY_INCR', 'STG_JDE_COMPANY_INIT']
	)
}}
select * from (
	SELECT 
		  UPPER(MD5_HEX( "EXT_SRC"."CCCO_BK" || '\#' )) AS "COMPANY_HKEY"
		, UPPER(MD5_HEX( 'JDE' || '\#' || "EXT_SRC"."ABAN8_FK_CCAN8_BK" || '\#' )) AS "ACCOUNT_HKEY"
		, UPPER(MD5_HEX( "EXT_SRC"."CCCO_BK" || '\#' || 'JDE' || '\#' || "EXT_SRC"."ABAN8_FK_CCAN8_BK" || '\#' )) AS "LNK_COMPANY_ACCOUNT_HKEY"
		, "EXT_SRC"."LOAD_DATE" AS "LOAD_DATE"
		, "EXT_SRC"."LOAD_CYCLE_ID" AS "LOAD_CYCLE_ID"
		, "EXT_SRC"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
		, "EXT_SRC"."JRN_FLAG" AS "JRN_FLAG"
		, "EXT_SRC"."RECORD_TYPE" AS "RECORD_TYPE"
		, "EXT_SRC"."CCCO" AS "CCCO"
		, "EXT_SRC"."CCAN8" AS "CCAN8"
		, "EXT_SRC"."CCCO_BK" AS "CCCO_BK"
		, "EXT_SRC"."ABAN8_FK_CCAN8_BK" AS "ABAN8_FK_CCAN8_BK"
		, "EXT_SRC"."CCNAME" AS "CCNAME"
		, "EXT_SRC"."CCALTC" AS "CCALTC"
		, "EXT_SRC"."CCDFYJ" AS "CCDFYJ"
		, "EXT_SRC"."CCPNC" AS "CCPNC"
		, "EXT_SRC"."CCDOT1" AS "CCDOT1"
		, "EXT_SRC"."CCCRYR" AS "CCCRYR"
		, "EXT_SRC"."CCCRYC" AS "CCCRYC"
		, "EXT_SRC"."CCDOT2" AS "CCDOT2"
		, "EXT_SRC"."CCMCUA" AS "CCMCUA"
		, "EXT_SRC"."CCMCUD" AS "CCMCUD"
		, "EXT_SRC"."CCMCUC" AS "CCMCUC"
		, "EXT_SRC"."CCMCUB" AS "CCMCUB"
		, "EXT_SRC"."CCDPRC" AS "CCDPRC"
		, "EXT_SRC"."CCBKTX" AS "CCBKTX"
		, "EXT_SRC"."CCTXBM" AS "CCTXBM"
		, "EXT_SRC"."CCTXBO" AS "CCTXBO"
		, "EXT_SRC"."CCNWXJ" AS "CCNWXJ"
		, "EXT_SRC"."CCGLIE" AS "CCGLIE"
		, "EXT_SRC"."CCABIN" AS "CCABIN"
		, "EXT_SRC"."CCCALD" AS "CCCALD"
		, "EXT_SRC"."CCDTPN" AS "CCDTPN"
		, "EXT_SRC"."CCPNF" AS "CCPNF"
		, "EXT_SRC"."CCDFF" AS "CCDFF"
		, "EXT_SRC"."CCCRCD" AS "CCCRCD"
		, "EXT_SRC"."CCSMI" AS "CCSMI"
		, "EXT_SRC"."CCSMU" AS "CCSMU"
		, "EXT_SRC"."CCSMS" AS "CCSMS"
		, "EXT_SRC"."CCDNLT" AS "CCDNLT"
		, "EXT_SRC"."CCSTMT" AS "CCSTMT"
		, "EXT_SRC"."CCATCS" AS "CCATCS"
		, "EXT_SRC"."CCALGM" AS "CCALGM"
		, "EXT_SRC"."CCAGEM" AS "CCAGEM"
		, "EXT_SRC"."CCCRDY" AS "CCCRDY"
		, "EXT_SRC"."CCAGR1" AS "CCAGR1"
		, "EXT_SRC"."CCAGR2" AS "CCAGR2"
		, "EXT_SRC"."CCAGR3" AS "CCAGR3"
		, "EXT_SRC"."CCAGR4" AS "CCAGR4"
		, "EXT_SRC"."CCAGR5" AS "CCAGR5"
		, "EXT_SRC"."CCAGR6" AS "CCAGR6"
		, "EXT_SRC"."CCAGR7" AS "CCAGR7"
		, "EXT_SRC"."CCFRY" AS "CCFRY"
		, "EXT_SRC"."CCFRP" AS "CCFRP"
		, "EXT_SRC"."CCNNP" AS "CCNNP"
		, "EXT_SRC"."CCFP" AS "CCFP"
		, "EXT_SRC"."CCAGE" AS "CCAGE"
		, "EXT_SRC"."CCDAG" AS "CCDAG"
		, "EXT_SRC"."CCARPN" AS "CCARPN"
		, "EXT_SRC"."CCAPPN" AS "CCAPPN"
		, "EXT_SRC"."CCARFJ" AS "CCARFJ"
		, "EXT_SRC"."CCAPFJ" AS "CCAPFJ"
		, "EXT_SRC"."CCSGBK" AS "CCSGBK"
		, "EXT_SRC"."CCPTCO" AS "CCPTCO"
		, "EXT_SRC"."CCX1" AS "CCX1"
		, "EXT_SRC"."CCX2" AS "CCX2"
		, "EXT_SRC"."CCUSER" AS "CCUSER"
		, "EXT_SRC"."CCPID" AS "CCPID"
		, "EXT_SRC"."CCUPMJ" AS "CCUPMJ"
		, "EXT_SRC"."CCJOBN" AS "CCJOBN"
		, "EXT_SRC"."CCUPMT" AS "CCUPMT"
		, "EXT_SRC"."CCTSID" AS "CCTSID"
		, "EXT_SRC"."CCTSCO" AS "CCTSCO"
		, "EXT_SRC"."CCTHCO" AS "CCTHCO"
		, "EXT_SRC"."CCAN8C" AS "CCAN8C"
	FROM {{ ref('JDEDWARDS_EXT_F0010') }} "EXT_SRC"
	INNER JOIN {{ source('JDEDWARDS_MTD', 'MTD_EXCEPTION_RECORDS') }} "MEX_SRC" ON  "MEX_SRC"."RECORD_TYPE" = 'U'

) final 
where '{{ var("load_type") }}' = 'INCR' and '{{ var("source") }}' = 'JDEDWARDS'

UNION ALL

select * from (
	SELECT 
		  UPPER(MD5_HEX( "EXT_SRC"."CCCO_BK" || '\#' )) AS "COMPANY_HKEY"
		, UPPER(MD5_HEX( 'JDE' || '\#' || "EXT_SRC"."ABAN8_FK_CCAN8_BK" || '\#' )) AS "ACCOUNT_HKEY"
		, UPPER(MD5_HEX( "EXT_SRC"."CCCO_BK" || '\#' || 'JDE' || '\#' || "EXT_SRC"."ABAN8_FK_CCAN8_BK" || '\#' )) AS "LNK_COMPANY_ACCOUNT_HKEY"
		, "EXT_SRC"."LOAD_DATE" AS "LOAD_DATE"
		, "EXT_SRC"."LOAD_CYCLE_ID" AS "LOAD_CYCLE_ID"
		, "EXT_SRC"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
		, "EXT_SRC"."JRN_FLAG" AS "JRN_FLAG"
		, "EXT_SRC"."RECORD_TYPE" AS "RECORD_TYPE"
		, "EXT_SRC"."CCCO" AS "CCCO"
		, "EXT_SRC"."CCAN8" AS "CCAN8"
		, "EXT_SRC"."CCCO_BK" AS "CCCO_BK"
		, "EXT_SRC"."ABAN8_FK_CCAN8_BK" AS "ABAN8_FK_CCAN8_BK"
		, "EXT_SRC"."CCNAME" AS "CCNAME"
		, "EXT_SRC"."CCALTC" AS "CCALTC"
		, "EXT_SRC"."CCDFYJ" AS "CCDFYJ"
		, "EXT_SRC"."CCPNC" AS "CCPNC"
		, "EXT_SRC"."CCDOT1" AS "CCDOT1"
		, "EXT_SRC"."CCCRYR" AS "CCCRYR"
		, "EXT_SRC"."CCCRYC" AS "CCCRYC"
		, "EXT_SRC"."CCDOT2" AS "CCDOT2"
		, "EXT_SRC"."CCMCUA" AS "CCMCUA"
		, "EXT_SRC"."CCMCUD" AS "CCMCUD"
		, "EXT_SRC"."CCMCUC" AS "CCMCUC"
		, "EXT_SRC"."CCMCUB" AS "CCMCUB"
		, "EXT_SRC"."CCDPRC" AS "CCDPRC"
		, "EXT_SRC"."CCBKTX" AS "CCBKTX"
		, "EXT_SRC"."CCTXBM" AS "CCTXBM"
		, "EXT_SRC"."CCTXBO" AS "CCTXBO"
		, "EXT_SRC"."CCNWXJ" AS "CCNWXJ"
		, "EXT_SRC"."CCGLIE" AS "CCGLIE"
		, "EXT_SRC"."CCABIN" AS "CCABIN"
		, "EXT_SRC"."CCCALD" AS "CCCALD"
		, "EXT_SRC"."CCDTPN" AS "CCDTPN"
		, "EXT_SRC"."CCPNF" AS "CCPNF"
		, "EXT_SRC"."CCDFF" AS "CCDFF"
		, "EXT_SRC"."CCCRCD" AS "CCCRCD"
		, "EXT_SRC"."CCSMI" AS "CCSMI"
		, "EXT_SRC"."CCSMU" AS "CCSMU"
		, "EXT_SRC"."CCSMS" AS "CCSMS"
		, "EXT_SRC"."CCDNLT" AS "CCDNLT"
		, "EXT_SRC"."CCSTMT" AS "CCSTMT"
		, "EXT_SRC"."CCATCS" AS "CCATCS"
		, "EXT_SRC"."CCALGM" AS "CCALGM"
		, "EXT_SRC"."CCAGEM" AS "CCAGEM"
		, "EXT_SRC"."CCCRDY" AS "CCCRDY"
		, "EXT_SRC"."CCAGR1" AS "CCAGR1"
		, "EXT_SRC"."CCAGR2" AS "CCAGR2"
		, "EXT_SRC"."CCAGR3" AS "CCAGR3"
		, "EXT_SRC"."CCAGR4" AS "CCAGR4"
		, "EXT_SRC"."CCAGR5" AS "CCAGR5"
		, "EXT_SRC"."CCAGR6" AS "CCAGR6"
		, "EXT_SRC"."CCAGR7" AS "CCAGR7"
		, "EXT_SRC"."CCFRY" AS "CCFRY"
		, "EXT_SRC"."CCFRP" AS "CCFRP"
		, "EXT_SRC"."CCNNP" AS "CCNNP"
		, "EXT_SRC"."CCFP" AS "CCFP"
		, "EXT_SRC"."CCAGE" AS "CCAGE"
		, "EXT_SRC"."CCDAG" AS "CCDAG"
		, "EXT_SRC"."CCARPN" AS "CCARPN"
		, "EXT_SRC"."CCAPPN" AS "CCAPPN"
		, "EXT_SRC"."CCARFJ" AS "CCARFJ"
		, "EXT_SRC"."CCAPFJ" AS "CCAPFJ"
		, "EXT_SRC"."CCSGBK" AS "CCSGBK"
		, "EXT_SRC"."CCPTCO" AS "CCPTCO"
		, "EXT_SRC"."CCX1" AS "CCX1"
		, "EXT_SRC"."CCX2" AS "CCX2"
		, "EXT_SRC"."CCUSER" AS "CCUSER"
		, "EXT_SRC"."CCPID" AS "CCPID"
		, "EXT_SRC"."CCUPMJ" AS "CCUPMJ"
		, "EXT_SRC"."CCJOBN" AS "CCJOBN"
		, "EXT_SRC"."CCUPMT" AS "CCUPMT"
		, "EXT_SRC"."CCTSID" AS "CCTSID"
		, "EXT_SRC"."CCTSCO" AS "CCTSCO"
		, "EXT_SRC"."CCTHCO" AS "CCTHCO"
		, "EXT_SRC"."CCAN8C" AS "CCAN8C"
	FROM {{ ref('JDEDWARDS_EXT_F0010') }} "EXT_SRC"
	INNER JOIN {{ source('JDEDWARDS_MTD', 'MTD_EXCEPTION_RECORDS') }} "MEX_SRC" ON  "MEX_SRC"."RECORD_TYPE" = 'U'

) final 
where '{{ var("load_type") }}' = 'INIT' and '{{ var("source") }}' = 'JDEDWARDS'