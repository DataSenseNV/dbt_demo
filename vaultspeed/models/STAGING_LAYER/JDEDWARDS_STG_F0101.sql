{{
	config(
		materialized='incremental',
		pre_hook= [
			'{% if var("load_type") == "INCR" and var("source") == "JDEDWARDS" %} TRUNCATE TABLE {{ this }}; {% endif %}',
			'{% if var("load_type") == "INIT" and var("source") == "JDEDWARDS" %} TRUNCATE TABLE {{ this }}; {% endif %}'
		],
		alias='F0101',
		schema='JDEDWARDS_STG',
		tags=['JDEDWARDS', 'STG_JDE_ADDRESSBOOK_INCR', 'STG_JDE_ADDRESSBOOK_INIT']
	)
}}
select * from (
	SELECT 
		  UPPER(MD5_HEX( 'JDE' || '\#' || "EXT_SRC"."ABAN8_BK" || '\#' )) AS "ACCOUNT_HKEY"
		, UPPER(MD5_HEX( "EXT_SRC"."MCMCU_FK_ABMCU_BK" || '\#' )) AS "BUSINESSUNITMASTER_HKEY"
		, UPPER(MD5_HEX( 'JDE' || '\#' || "EXT_SRC"."ABAN8_BK" || '\#' || "EXT_SRC"."MCMCU_FK_ABMCU_BK" || '\#' )) AS "LNK_ACCOUNT_BUSINESSUNITMASTER_HKEY"
		, "EXT_SRC"."LOAD_DATE" AS "LOAD_DATE"
		, "EXT_SRC"."LOAD_CYCLE_ID" AS "LOAD_CYCLE_ID"
		, 'JDE' AS "SRC_BK"
		, "EXT_SRC"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
		, "EXT_SRC"."JRN_FLAG" AS "JRN_FLAG"
		, "EXT_SRC"."RECORD_TYPE" AS "RECORD_TYPE"
		, "EXT_SRC"."ABAN8" AS "ABAN8"
		, "EXT_SRC"."ABMCU" AS "ABMCU"
		, "EXT_SRC"."ABAN8_BK" AS "ACCOUNT_BK"
		, "EXT_SRC"."MCMCU_FK_ABMCU_BK" AS "MCMCU_FK_ABMCU_BK"
		, "EXT_SRC"."ABALKY" AS "ABALKY"
		, "EXT_SRC"."ABTAX" AS "ABTAX"
		, "EXT_SRC"."ABALPH" AS "ABALPH"
		, "EXT_SRC"."ABDC" AS "ABDC"
		, "EXT_SRC"."ABSIC" AS "ABSIC"
		, "EXT_SRC"."ABLNGP" AS "ABLNGP"
		, "EXT_SRC"."ABAT1" AS "ABAT1"
		, "EXT_SRC"."ABCM" AS "ABCM"
		, "EXT_SRC"."ABTAXC" AS "ABTAXC"
		, "EXT_SRC"."ABAT2" AS "ABAT2"
		, "EXT_SRC"."ABAT3" AS "ABAT3"
		, "EXT_SRC"."ABAT4" AS "ABAT4"
		, "EXT_SRC"."ABAT5" AS "ABAT5"
		, "EXT_SRC"."ABATP" AS "ABATP"
		, "EXT_SRC"."ABATR" AS "ABATR"
		, "EXT_SRC"."ABATPR" AS "ABATPR"
		, "EXT_SRC"."ABAB3" AS "ABAB3"
		, "EXT_SRC"."ABATE" AS "ABATE"
		, "EXT_SRC"."ABSBLI" AS "ABSBLI"
		, "EXT_SRC"."ABEFTB" AS "ABEFTB"
		, "EXT_SRC"."ABAN81" AS "ABAN81"
		, "EXT_SRC"."ABAN82" AS "ABAN82"
		, "EXT_SRC"."ABAN83" AS "ABAN83"
		, "EXT_SRC"."ABAN84" AS "ABAN84"
		, "EXT_SRC"."ABAN86" AS "ABAN86"
		, "EXT_SRC"."ABAN85" AS "ABAN85"
		, "EXT_SRC"."ABAC01" AS "ABAC01"
		, "EXT_SRC"."ABAC02" AS "ABAC02"
		, "EXT_SRC"."ABAC03" AS "ABAC03"
		, "EXT_SRC"."ABAC04" AS "ABAC04"
		, "EXT_SRC"."ABAC05" AS "ABAC05"
		, "EXT_SRC"."ABAC06" AS "ABAC06"
		, "EXT_SRC"."ABAC07" AS "ABAC07"
		, "EXT_SRC"."ABAC08" AS "ABAC08"
		, "EXT_SRC"."ABAC09" AS "ABAC09"
		, "EXT_SRC"."ABAC10" AS "ABAC10"
		, "EXT_SRC"."ABAC11" AS "ABAC11"
		, "EXT_SRC"."ABAC12" AS "ABAC12"
		, "EXT_SRC"."ABAC13" AS "ABAC13"
		, "EXT_SRC"."ABAC14" AS "ABAC14"
		, "EXT_SRC"."ABAC15" AS "ABAC15"
		, "EXT_SRC"."ABAC16" AS "ABAC16"
		, "EXT_SRC"."ABAC17" AS "ABAC17"
		, "EXT_SRC"."ABAC18" AS "ABAC18"
		, "EXT_SRC"."ABAC19" AS "ABAC19"
		, "EXT_SRC"."ABAC20" AS "ABAC20"
		, "EXT_SRC"."ABAC21" AS "ABAC21"
		, "EXT_SRC"."ABAC22" AS "ABAC22"
		, "EXT_SRC"."ABAC23" AS "ABAC23"
		, "EXT_SRC"."ABAC24" AS "ABAC24"
		, "EXT_SRC"."ABAC25" AS "ABAC25"
		, "EXT_SRC"."ABAC26" AS "ABAC26"
		, "EXT_SRC"."ABAC27" AS "ABAC27"
		, "EXT_SRC"."ABAC28" AS "ABAC28"
		, "EXT_SRC"."ABAC29" AS "ABAC29"
		, "EXT_SRC"."ABAC30" AS "ABAC30"
		, "EXT_SRC"."ABGLBA" AS "ABGLBA"
		, "EXT_SRC"."ABPTI" AS "ABPTI"
		, "EXT_SRC"."ABPDI" AS "ABPDI"
		, "EXT_SRC"."ABMSGA" AS "ABMSGA"
		, "EXT_SRC"."ABRMK" AS "ABRMK"
		, "EXT_SRC"."ABTXCT" AS "ABTXCT"
		, "EXT_SRC"."ABTX2" AS "ABTX2"
		, "EXT_SRC"."ABALP1" AS "ABALP1"
		, "EXT_SRC"."ABURCD" AS "ABURCD"
		, "EXT_SRC"."ABURDT" AS "ABURDT"
		, "EXT_SRC"."ABURAT" AS "ABURAT"
		, "EXT_SRC"."ABURAB" AS "ABURAB"
		, "EXT_SRC"."ABURRF" AS "ABURRF"
		, "EXT_SRC"."ABUSER" AS "ABUSER"
		, "EXT_SRC"."ABPID" AS "ABPID"
		, "EXT_SRC"."ABUPMJ" AS "ABUPMJ"
		, "EXT_SRC"."ABJOBN" AS "ABJOBN"
		, "EXT_SRC"."ABUPMT" AS "ABUPMT"
		, "EXT_SRC"."ABPRGF" AS "ABPRGF"
		, "EXT_SRC"."ABSCCLTP" AS "ABSCCLTP"
		, "EXT_SRC"."ABTICKER" AS "ABTICKER"
		, "EXT_SRC"."ABEXCHG" AS "ABEXCHG"
		, "EXT_SRC"."ABDUNS" AS "ABDUNS"
		, "EXT_SRC"."ABCLASS01" AS "ABCLASS01"
		, "EXT_SRC"."ABCLASS02" AS "ABCLASS02"
		, "EXT_SRC"."ABCLASS03" AS "ABCLASS03"
		, "EXT_SRC"."ABCLASS04" AS "ABCLASS04"
		, "EXT_SRC"."ABCLASS05" AS "ABCLASS05"
		, "EXT_SRC"."ABNOE" AS "ABNOE"
		, "EXT_SRC"."ABGROWTHR" AS "ABGROWTHR"
		, "EXT_SRC"."ABYEARSTAR" AS "ABYEARSTAR"
		, "EXT_SRC"."ABAEMPGP" AS "ABAEMPGP"
		, "EXT_SRC"."ABACTIN" AS "ABACTIN"
		, "EXT_SRC"."ABREVRNG" AS "ABREVRNG"
		, "EXT_SRC"."ABSYNCS" AS "ABSYNCS"
		, "EXT_SRC"."ABPERRS" AS "ABPERRS"
		, "EXT_SRC"."ABCAAD" AS "ABCAAD"
	FROM {{ ref('JDEDWARDS_EXT_F0101') }} "EXT_SRC"
	INNER JOIN {{ source('JDEDWARDS_MTD', 'MTD_EXCEPTION_RECORDS') }} "MEX_SRC" ON  "MEX_SRC"."RECORD_TYPE" = 'U'

) final 
where '{{ var("load_type") }}' = 'INCR' and '{{ var("source") }}' = 'JDEDWARDS'

UNION ALL

select * from (
	SELECT 
		  UPPER(MD5_HEX( 'JDE' || '\#' || "EXT_SRC"."ABAN8_BK" || '\#' )) AS "ACCOUNT_HKEY"
		, UPPER(MD5_HEX( "EXT_SRC"."MCMCU_FK_ABMCU_BK" || '\#' )) AS "BUSINESSUNITMASTER_HKEY"
		, UPPER(MD5_HEX( 'JDE' || '\#' || "EXT_SRC"."ABAN8_BK" || '\#' || "EXT_SRC"."MCMCU_FK_ABMCU_BK" || '\#' )) AS "LNK_ACCOUNT_BUSINESSUNITMASTER_HKEY"
		, "EXT_SRC"."LOAD_DATE" AS "LOAD_DATE"
		, "EXT_SRC"."LOAD_CYCLE_ID" AS "LOAD_CYCLE_ID"
		, 'JDE' AS "SRC_BK"
		, "EXT_SRC"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
		, "EXT_SRC"."JRN_FLAG" AS "JRN_FLAG"
		, "EXT_SRC"."RECORD_TYPE" AS "RECORD_TYPE"
		, "EXT_SRC"."ABAN8" AS "ABAN8"
		, "EXT_SRC"."ABMCU" AS "ABMCU"
		, "EXT_SRC"."ABAN8_BK" AS "ACCOUNT_BK"
		, "EXT_SRC"."MCMCU_FK_ABMCU_BK" AS "MCMCU_FK_ABMCU_BK"
		, "EXT_SRC"."ABALKY" AS "ABALKY"
		, "EXT_SRC"."ABTAX" AS "ABTAX"
		, "EXT_SRC"."ABALPH" AS "ABALPH"
		, "EXT_SRC"."ABDC" AS "ABDC"
		, "EXT_SRC"."ABSIC" AS "ABSIC"
		, "EXT_SRC"."ABLNGP" AS "ABLNGP"
		, "EXT_SRC"."ABAT1" AS "ABAT1"
		, "EXT_SRC"."ABCM" AS "ABCM"
		, "EXT_SRC"."ABTAXC" AS "ABTAXC"
		, "EXT_SRC"."ABAT2" AS "ABAT2"
		, "EXT_SRC"."ABAT3" AS "ABAT3"
		, "EXT_SRC"."ABAT4" AS "ABAT4"
		, "EXT_SRC"."ABAT5" AS "ABAT5"
		, "EXT_SRC"."ABATP" AS "ABATP"
		, "EXT_SRC"."ABATR" AS "ABATR"
		, "EXT_SRC"."ABATPR" AS "ABATPR"
		, "EXT_SRC"."ABAB3" AS "ABAB3"
		, "EXT_SRC"."ABATE" AS "ABATE"
		, "EXT_SRC"."ABSBLI" AS "ABSBLI"
		, "EXT_SRC"."ABEFTB" AS "ABEFTB"
		, "EXT_SRC"."ABAN81" AS "ABAN81"
		, "EXT_SRC"."ABAN82" AS "ABAN82"
		, "EXT_SRC"."ABAN83" AS "ABAN83"
		, "EXT_SRC"."ABAN84" AS "ABAN84"
		, "EXT_SRC"."ABAN86" AS "ABAN86"
		, "EXT_SRC"."ABAN85" AS "ABAN85"
		, "EXT_SRC"."ABAC01" AS "ABAC01"
		, "EXT_SRC"."ABAC02" AS "ABAC02"
		, "EXT_SRC"."ABAC03" AS "ABAC03"
		, "EXT_SRC"."ABAC04" AS "ABAC04"
		, "EXT_SRC"."ABAC05" AS "ABAC05"
		, "EXT_SRC"."ABAC06" AS "ABAC06"
		, "EXT_SRC"."ABAC07" AS "ABAC07"
		, "EXT_SRC"."ABAC08" AS "ABAC08"
		, "EXT_SRC"."ABAC09" AS "ABAC09"
		, "EXT_SRC"."ABAC10" AS "ABAC10"
		, "EXT_SRC"."ABAC11" AS "ABAC11"
		, "EXT_SRC"."ABAC12" AS "ABAC12"
		, "EXT_SRC"."ABAC13" AS "ABAC13"
		, "EXT_SRC"."ABAC14" AS "ABAC14"
		, "EXT_SRC"."ABAC15" AS "ABAC15"
		, "EXT_SRC"."ABAC16" AS "ABAC16"
		, "EXT_SRC"."ABAC17" AS "ABAC17"
		, "EXT_SRC"."ABAC18" AS "ABAC18"
		, "EXT_SRC"."ABAC19" AS "ABAC19"
		, "EXT_SRC"."ABAC20" AS "ABAC20"
		, "EXT_SRC"."ABAC21" AS "ABAC21"
		, "EXT_SRC"."ABAC22" AS "ABAC22"
		, "EXT_SRC"."ABAC23" AS "ABAC23"
		, "EXT_SRC"."ABAC24" AS "ABAC24"
		, "EXT_SRC"."ABAC25" AS "ABAC25"
		, "EXT_SRC"."ABAC26" AS "ABAC26"
		, "EXT_SRC"."ABAC27" AS "ABAC27"
		, "EXT_SRC"."ABAC28" AS "ABAC28"
		, "EXT_SRC"."ABAC29" AS "ABAC29"
		, "EXT_SRC"."ABAC30" AS "ABAC30"
		, "EXT_SRC"."ABGLBA" AS "ABGLBA"
		, "EXT_SRC"."ABPTI" AS "ABPTI"
		, "EXT_SRC"."ABPDI" AS "ABPDI"
		, "EXT_SRC"."ABMSGA" AS "ABMSGA"
		, "EXT_SRC"."ABRMK" AS "ABRMK"
		, "EXT_SRC"."ABTXCT" AS "ABTXCT"
		, "EXT_SRC"."ABTX2" AS "ABTX2"
		, "EXT_SRC"."ABALP1" AS "ABALP1"
		, "EXT_SRC"."ABURCD" AS "ABURCD"
		, "EXT_SRC"."ABURDT" AS "ABURDT"
		, "EXT_SRC"."ABURAT" AS "ABURAT"
		, "EXT_SRC"."ABURAB" AS "ABURAB"
		, "EXT_SRC"."ABURRF" AS "ABURRF"
		, "EXT_SRC"."ABUSER" AS "ABUSER"
		, "EXT_SRC"."ABPID" AS "ABPID"
		, "EXT_SRC"."ABUPMJ" AS "ABUPMJ"
		, "EXT_SRC"."ABJOBN" AS "ABJOBN"
		, "EXT_SRC"."ABUPMT" AS "ABUPMT"
		, "EXT_SRC"."ABPRGF" AS "ABPRGF"
		, "EXT_SRC"."ABSCCLTP" AS "ABSCCLTP"
		, "EXT_SRC"."ABTICKER" AS "ABTICKER"
		, "EXT_SRC"."ABEXCHG" AS "ABEXCHG"
		, "EXT_SRC"."ABDUNS" AS "ABDUNS"
		, "EXT_SRC"."ABCLASS01" AS "ABCLASS01"
		, "EXT_SRC"."ABCLASS02" AS "ABCLASS02"
		, "EXT_SRC"."ABCLASS03" AS "ABCLASS03"
		, "EXT_SRC"."ABCLASS04" AS "ABCLASS04"
		, "EXT_SRC"."ABCLASS05" AS "ABCLASS05"
		, "EXT_SRC"."ABNOE" AS "ABNOE"
		, "EXT_SRC"."ABGROWTHR" AS "ABGROWTHR"
		, "EXT_SRC"."ABYEARSTAR" AS "ABYEARSTAR"
		, "EXT_SRC"."ABAEMPGP" AS "ABAEMPGP"
		, "EXT_SRC"."ABACTIN" AS "ABACTIN"
		, "EXT_SRC"."ABREVRNG" AS "ABREVRNG"
		, "EXT_SRC"."ABSYNCS" AS "ABSYNCS"
		, "EXT_SRC"."ABPERRS" AS "ABPERRS"
		, "EXT_SRC"."ABCAAD" AS "ABCAAD"
	FROM {{ ref('JDEDWARDS_EXT_F0101') }} "EXT_SRC"
	INNER JOIN {{ source('JDEDWARDS_MTD', 'MTD_EXCEPTION_RECORDS') }} "MEX_SRC" ON  "MEX_SRC"."RECORD_TYPE" = 'U'

) final 
where '{{ var("load_type") }}' = 'INIT' and '{{ var("source") }}' = 'JDEDWARDS'