{{
	config(
		materialized='incremental',
		pre_hook= [
			'{% if var("load_type") == "INIT" and var("source") == "JDEDWARDS" %} TRUNCATE TABLE {{ this }}; {% endif %}'
		],
		alias='SAT_JDE_WHOISWHO',
		schema='DEMO_FL',
		unique_key = ['"WHOISWHO_HKEY"', '"LOAD_DATE"'],
		merge_update_columns = ['"LOAD_END_DATE"', '"DELETE_FLAG"', '"CDC_TIMESTAMP"'],
		tags=['JDEDWARDS', 'SAT_JDE_WHOISWHO_INCR', 'SAT_JDE_WHOISWHO_INIT']
	)
}}
select * from (
	WITH "END_DATING" AS 
	( 
		SELECT 
			  "SAT_TEMP_SRC_DK"."WHOISWHO_HKEY" AS "WHOISWHO_HKEY"
			, "SAT_TEMP_SRC_DK"."LOAD_DATE" AS "LOAD_DATE"
			, CASE WHEN LEAD( "SAT_TEMP_SRC_DK"."DELETE_FLAG" || "SAT_TEMP_SRC_DK"."SOURCE",1)OVER(PARTITION BY "SAT_TEMP_SRC_DK"."WHOISWHO_HKEY" ORDER BY "SAT_TEMP_SRC_DK"."LOAD_DATE",
				"SAT_TEMP_SRC_DK"."LOAD_CYCLE_ID")= 'Y' || 'STG' THEN CAST('Y' AS VARCHAR) ELSE "SAT_TEMP_SRC_DK"."DELETE_FLAG" END AS "DELETE_FLAG"
			, LEAD("SAT_TEMP_SRC_DK"."CDC_TIMESTAMP",1)OVER(PARTITION BY "SAT_TEMP_SRC_DK"."WHOISWHO_HKEY" ORDER BY "SAT_TEMP_SRC_DK"."LOAD_DATE") AS "CDC_TIMESTAMP"
		FROM {{ ref('JDEDWARDS_STG_SAT_JDE_WHOISWHO_TMP') }} "SAT_TEMP_SRC_DK"
		WHERE  "SAT_TEMP_SRC_DK"."EQUAL" = 0
	)
	, "CALC_LOAD_END_DATE" AS 
	( 
		SELECT 
			  "SAT_TEMP_SRC_US"."WHOISWHO_HKEY" AS "WHOISWHO_HKEY"
			, "SAT_TEMP_SRC_US"."LOAD_DATE" AS "LOAD_DATE"
			, "SAT_TEMP_SRC_US"."LOAD_CYCLE_ID" AS "LOAD_CYCLE_ID"
			, COALESCE(LEAD("SAT_TEMP_SRC_US"."LOAD_DATE",1)OVER(PARTITION BY "SAT_TEMP_SRC_US"."WHOISWHO_HKEY" ORDER BY "SAT_TEMP_SRC_US"."LOAD_DATE")
				, TO_TIMESTAMP('31/12/2999 23:59:59', 'DD/MM/YYYY HH24:MI:SS')) AS "LOAD_END_DATE"
			, "END_DATING"."DELETE_FLAG" AS "DELETE_FLAG"
			, "SAT_TEMP_SRC_US"."SOURCE" AS "SOURCE"
			, "SAT_TEMP_SRC_US"."HASH_DIFF" AS "HASH_DIFF"
			, CASE WHEN "END_DATING"."DELETE_FLAG" = CAST('Y' AS VARCHAR) THEN "END_DATING"."CDC_TIMESTAMP" ELSE "SAT_TEMP_SRC_US"."CDC_TIMESTAMP" END AS "CDC_TIMESTAMP"
			, "SAT_TEMP_SRC_US"."WWAN8" AS "WWAN8"
			, "SAT_TEMP_SRC_US"."WWIDLN" AS "WWIDLN"
			, "SAT_TEMP_SRC_US"."WWDSS5" AS "WWDSS5"
			, "SAT_TEMP_SRC_US"."WWMLNM" AS "WWMLNM"
			, "SAT_TEMP_SRC_US"."WWATTL" AS "WWATTL"
			, "SAT_TEMP_SRC_US"."WWREM1" AS "WWREM1"
			, "SAT_TEMP_SRC_US"."WWSLNM" AS "WWSLNM"
			, "SAT_TEMP_SRC_US"."WWALPH" AS "WWALPH"
			, "SAT_TEMP_SRC_US"."WWDC" AS "WWDC"
			, "SAT_TEMP_SRC_US"."WWGNNM" AS "WWGNNM"
			, "SAT_TEMP_SRC_US"."WWMDNM" AS "WWMDNM"
			, "SAT_TEMP_SRC_US"."WWSRNM" AS "WWSRNM"
			, "SAT_TEMP_SRC_US"."WWTYC" AS "WWTYC"
			, "SAT_TEMP_SRC_US"."WWW001" AS "WWW001"
			, "SAT_TEMP_SRC_US"."WWW002" AS "WWW002"
			, "SAT_TEMP_SRC_US"."WWW003" AS "WWW003"
			, "SAT_TEMP_SRC_US"."WWW004" AS "WWW004"
			, "SAT_TEMP_SRC_US"."WWW005" AS "WWW005"
			, "SAT_TEMP_SRC_US"."WWW006" AS "WWW006"
			, "SAT_TEMP_SRC_US"."WWW007" AS "WWW007"
			, "SAT_TEMP_SRC_US"."WWW008" AS "WWW008"
			, "SAT_TEMP_SRC_US"."WWW009" AS "WWW009"
			, "SAT_TEMP_SRC_US"."WWW010" AS "WWW010"
			, "SAT_TEMP_SRC_US"."WWMLN1" AS "WWMLN1"
			, "SAT_TEMP_SRC_US"."WWALP1" AS "WWALP1"
			, "SAT_TEMP_SRC_US"."WWUSER" AS "WWUSER"
			, "SAT_TEMP_SRC_US"."WWPID" AS "WWPID"
			, "SAT_TEMP_SRC_US"."WWUPMJ" AS "WWUPMJ"
			, "SAT_TEMP_SRC_US"."WWJOBN" AS "WWJOBN"
			, "SAT_TEMP_SRC_US"."WWUPMT" AS "WWUPMT"
			, "SAT_TEMP_SRC_US"."WWNTYP" AS "WWNTYP"
			, "SAT_TEMP_SRC_US"."WWNICK" AS "WWNICK"
			, "SAT_TEMP_SRC_US"."WWGEND" AS "WWGEND"
			, "SAT_TEMP_SRC_US"."WWDDATE" AS "WWDDATE"
			, "SAT_TEMP_SRC_US"."WWDMON" AS "WWDMON"
			, "SAT_TEMP_SRC_US"."WWDYR" AS "WWDYR"
			, "SAT_TEMP_SRC_US"."WWWN001" AS "WWWN001"
			, "SAT_TEMP_SRC_US"."WWWN002" AS "WWWN002"
			, "SAT_TEMP_SRC_US"."WWWN003" AS "WWWN003"
			, "SAT_TEMP_SRC_US"."WWWN004" AS "WWWN004"
			, "SAT_TEMP_SRC_US"."WWWN005" AS "WWWN005"
			, "SAT_TEMP_SRC_US"."WWWN006" AS "WWWN006"
			, "SAT_TEMP_SRC_US"."WWWN007" AS "WWWN007"
			, "SAT_TEMP_SRC_US"."WWWN008" AS "WWWN008"
			, "SAT_TEMP_SRC_US"."WWWN009" AS "WWWN009"
			, "SAT_TEMP_SRC_US"."WWWN010" AS "WWWN010"
			, "SAT_TEMP_SRC_US"."WWFUCO" AS "WWFUCO"
			, "SAT_TEMP_SRC_US"."WWPCM" AS "WWPCM"
			, "SAT_TEMP_SRC_US"."WWPCF" AS "WWPCF"
			, "SAT_TEMP_SRC_US"."WWACTIN" AS "WWACTIN"
			, "SAT_TEMP_SRC_US"."WWCFRGUID" AS "WWCFRGUID"
			, "SAT_TEMP_SRC_US"."WWSYNCS" AS "WWSYNCS"
			, "SAT_TEMP_SRC_US"."WWCAAD" AS "WWCAAD"
		FROM {{ ref('JDEDWARDS_STG_SAT_JDE_WHOISWHO_TMP') }} "SAT_TEMP_SRC_US"
		INNER JOIN "END_DATING" "END_DATING" ON  "SAT_TEMP_SRC_US"."WHOISWHO_HKEY" = "END_DATING"."WHOISWHO_HKEY" AND "SAT_TEMP_SRC_US"."LOAD_DATE" = 
			"END_DATING"."LOAD_DATE"
		WHERE  "SAT_TEMP_SRC_US"."EQUAL" = 0 AND NOT("SAT_TEMP_SRC_US"."DELETE_FLAG" = CAST('Y' AS VARCHAR) AND "SAT_TEMP_SRC_US"."SOURCE" = 'STG')
	)
	, "FILTER_LOAD_END_DATE" AS 
	( 
		SELECT 
			  "CALC_LOAD_END_DATE"."WHOISWHO_HKEY" AS "WHOISWHO_HKEY"
			, "CALC_LOAD_END_DATE"."LOAD_DATE" AS "LOAD_DATE"
			, "CALC_LOAD_END_DATE"."LOAD_CYCLE_ID" AS "LOAD_CYCLE_ID"
			, "CALC_LOAD_END_DATE"."LOAD_END_DATE" AS "LOAD_END_DATE"
			, "CALC_LOAD_END_DATE"."DELETE_FLAG" AS "DELETE_FLAG"
			, "CALC_LOAD_END_DATE"."HASH_DIFF" AS "HASH_DIFF"
			, "CALC_LOAD_END_DATE"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
			, "CALC_LOAD_END_DATE"."WWAN8" AS "WWAN8"
			, "CALC_LOAD_END_DATE"."WWIDLN" AS "WWIDLN"
			, "CALC_LOAD_END_DATE"."WWDSS5" AS "WWDSS5"
			, "CALC_LOAD_END_DATE"."WWMLNM" AS "WWMLNM"
			, "CALC_LOAD_END_DATE"."WWATTL" AS "WWATTL"
			, "CALC_LOAD_END_DATE"."WWREM1" AS "WWREM1"
			, "CALC_LOAD_END_DATE"."WWSLNM" AS "WWSLNM"
			, "CALC_LOAD_END_DATE"."WWALPH" AS "WWALPH"
			, "CALC_LOAD_END_DATE"."WWDC" AS "WWDC"
			, "CALC_LOAD_END_DATE"."WWGNNM" AS "WWGNNM"
			, "CALC_LOAD_END_DATE"."WWMDNM" AS "WWMDNM"
			, "CALC_LOAD_END_DATE"."WWSRNM" AS "WWSRNM"
			, "CALC_LOAD_END_DATE"."WWTYC" AS "WWTYC"
			, "CALC_LOAD_END_DATE"."WWW001" AS "WWW001"
			, "CALC_LOAD_END_DATE"."WWW002" AS "WWW002"
			, "CALC_LOAD_END_DATE"."WWW003" AS "WWW003"
			, "CALC_LOAD_END_DATE"."WWW004" AS "WWW004"
			, "CALC_LOAD_END_DATE"."WWW005" AS "WWW005"
			, "CALC_LOAD_END_DATE"."WWW006" AS "WWW006"
			, "CALC_LOAD_END_DATE"."WWW007" AS "WWW007"
			, "CALC_LOAD_END_DATE"."WWW008" AS "WWW008"
			, "CALC_LOAD_END_DATE"."WWW009" AS "WWW009"
			, "CALC_LOAD_END_DATE"."WWW010" AS "WWW010"
			, "CALC_LOAD_END_DATE"."WWMLN1" AS "WWMLN1"
			, "CALC_LOAD_END_DATE"."WWALP1" AS "WWALP1"
			, "CALC_LOAD_END_DATE"."WWUSER" AS "WWUSER"
			, "CALC_LOAD_END_DATE"."WWPID" AS "WWPID"
			, "CALC_LOAD_END_DATE"."WWUPMJ" AS "WWUPMJ"
			, "CALC_LOAD_END_DATE"."WWJOBN" AS "WWJOBN"
			, "CALC_LOAD_END_DATE"."WWUPMT" AS "WWUPMT"
			, "CALC_LOAD_END_DATE"."WWNTYP" AS "WWNTYP"
			, "CALC_LOAD_END_DATE"."WWNICK" AS "WWNICK"
			, "CALC_LOAD_END_DATE"."WWGEND" AS "WWGEND"
			, "CALC_LOAD_END_DATE"."WWDDATE" AS "WWDDATE"
			, "CALC_LOAD_END_DATE"."WWDMON" AS "WWDMON"
			, "CALC_LOAD_END_DATE"."WWDYR" AS "WWDYR"
			, "CALC_LOAD_END_DATE"."WWWN001" AS "WWWN001"
			, "CALC_LOAD_END_DATE"."WWWN002" AS "WWWN002"
			, "CALC_LOAD_END_DATE"."WWWN003" AS "WWWN003"
			, "CALC_LOAD_END_DATE"."WWWN004" AS "WWWN004"
			, "CALC_LOAD_END_DATE"."WWWN005" AS "WWWN005"
			, "CALC_LOAD_END_DATE"."WWWN006" AS "WWWN006"
			, "CALC_LOAD_END_DATE"."WWWN007" AS "WWWN007"
			, "CALC_LOAD_END_DATE"."WWWN008" AS "WWWN008"
			, "CALC_LOAD_END_DATE"."WWWN009" AS "WWWN009"
			, "CALC_LOAD_END_DATE"."WWWN010" AS "WWWN010"
			, "CALC_LOAD_END_DATE"."WWFUCO" AS "WWFUCO"
			, "CALC_LOAD_END_DATE"."WWPCM" AS "WWPCM"
			, "CALC_LOAD_END_DATE"."WWPCF" AS "WWPCF"
			, "CALC_LOAD_END_DATE"."WWACTIN" AS "WWACTIN"
			, "CALC_LOAD_END_DATE"."WWCFRGUID" AS "WWCFRGUID"
			, "CALC_LOAD_END_DATE"."WWSYNCS" AS "WWSYNCS"
			, "CALC_LOAD_END_DATE"."WWCAAD" AS "WWCAAD"
		FROM "CALC_LOAD_END_DATE" "CALC_LOAD_END_DATE"
		WHERE  "CALC_LOAD_END_DATE"."DELETE_FLAG" = CAST('Y' AS VARCHAR) OR "CALC_LOAD_END_DATE"."SOURCE" = 'STG' OR("CALC_LOAD_END_DATE"."SOURCE" = 'SAT' AND "CALC_LOAD_END_DATE"."LOAD_END_DATE" != TO_TIMESTAMP('31/12/2999 23:59:59', 'DD/MM/YYYY HH24:MI:SS'))
	)
	SELECT 
		  "FILTER_LOAD_END_DATE"."WHOISWHO_HKEY"
		, "FILTER_LOAD_END_DATE"."LOAD_DATE"
		, "FILTER_LOAD_END_DATE"."LOAD_END_DATE"
		, "FILTER_LOAD_END_DATE"."LOAD_CYCLE_ID"
		, "FILTER_LOAD_END_DATE"."HASH_DIFF"
		, "FILTER_LOAD_END_DATE"."DELETE_FLAG"
		, "FILTER_LOAD_END_DATE"."CDC_TIMESTAMP"
		, "FILTER_LOAD_END_DATE"."WWAN8"
		, "FILTER_LOAD_END_DATE"."WWIDLN"
		, "FILTER_LOAD_END_DATE"."WWDSS5"
		, "FILTER_LOAD_END_DATE"."WWMLNM"
		, "FILTER_LOAD_END_DATE"."WWATTL"
		, "FILTER_LOAD_END_DATE"."WWREM1"
		, "FILTER_LOAD_END_DATE"."WWSLNM"
		, "FILTER_LOAD_END_DATE"."WWALPH"
		, "FILTER_LOAD_END_DATE"."WWDC"
		, "FILTER_LOAD_END_DATE"."WWGNNM"
		, "FILTER_LOAD_END_DATE"."WWMDNM"
		, "FILTER_LOAD_END_DATE"."WWSRNM"
		, "FILTER_LOAD_END_DATE"."WWTYC"
		, "FILTER_LOAD_END_DATE"."WWW001"
		, "FILTER_LOAD_END_DATE"."WWW002"
		, "FILTER_LOAD_END_DATE"."WWW003"
		, "FILTER_LOAD_END_DATE"."WWW004"
		, "FILTER_LOAD_END_DATE"."WWW005"
		, "FILTER_LOAD_END_DATE"."WWW006"
		, "FILTER_LOAD_END_DATE"."WWW007"
		, "FILTER_LOAD_END_DATE"."WWW008"
		, "FILTER_LOAD_END_DATE"."WWW009"
		, "FILTER_LOAD_END_DATE"."WWW010"
		, "FILTER_LOAD_END_DATE"."WWMLN1"
		, "FILTER_LOAD_END_DATE"."WWALP1"
		, "FILTER_LOAD_END_DATE"."WWUSER"
		, "FILTER_LOAD_END_DATE"."WWPID"
		, "FILTER_LOAD_END_DATE"."WWUPMJ"
		, "FILTER_LOAD_END_DATE"."WWJOBN"
		, "FILTER_LOAD_END_DATE"."WWUPMT"
		, "FILTER_LOAD_END_DATE"."WWNTYP"
		, "FILTER_LOAD_END_DATE"."WWNICK"
		, "FILTER_LOAD_END_DATE"."WWGEND"
		, "FILTER_LOAD_END_DATE"."WWDDATE"
		, "FILTER_LOAD_END_DATE"."WWDMON"
		, "FILTER_LOAD_END_DATE"."WWDYR"
		, "FILTER_LOAD_END_DATE"."WWWN001"
		, "FILTER_LOAD_END_DATE"."WWWN002"
		, "FILTER_LOAD_END_DATE"."WWWN003"
		, "FILTER_LOAD_END_DATE"."WWWN004"
		, "FILTER_LOAD_END_DATE"."WWWN005"
		, "FILTER_LOAD_END_DATE"."WWWN006"
		, "FILTER_LOAD_END_DATE"."WWWN007"
		, "FILTER_LOAD_END_DATE"."WWWN008"
		, "FILTER_LOAD_END_DATE"."WWWN009"
		, "FILTER_LOAD_END_DATE"."WWWN010"
		, "FILTER_LOAD_END_DATE"."WWFUCO"
		, "FILTER_LOAD_END_DATE"."WWPCM"
		, "FILTER_LOAD_END_DATE"."WWPCF"
		, "FILTER_LOAD_END_DATE"."WWACTIN"
		, "FILTER_LOAD_END_DATE"."WWCFRGUID"
		, "FILTER_LOAD_END_DATE"."WWSYNCS"
		, "FILTER_LOAD_END_DATE"."WWCAAD"
	FROM "FILTER_LOAD_END_DATE"

) final 
where '{{ var("load_type") }}' = 'INCR' and '{{ var("source") }}' = 'JDEDWARDS'

UNION ALL

select * from (
	WITH "STG_SRC" AS 
	( 
		SELECT 
			  "STG_INR_SRC"."WHOISWHO_HKEY" AS "WHOISWHO_HKEY"
			, "STG_INR_SRC"."LOAD_DATE" AS "LOAD_DATE"
			, TO_TIMESTAMP('31/12/2999 23:59:59' , 'DD/MM/YYYY HH24:MI:SS') AS "LOAD_END_DATE"
			, "STG_INR_SRC"."LOAD_CYCLE_ID" AS "LOAD_CYCLE_ID"
			, UPPER(MD5_HEX(COALESCE(RTRIM( UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."WWDSS5")),'~'),'\#','\\' || 
				'\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWMLNM"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWATTL"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWREM1"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWSLNM"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWALPH"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWDC"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWGNNM"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWMDNM"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWSRNM"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWTYC"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWW001"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWW002"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWW003"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWW004"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWW005"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWW006"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWW007"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWW008"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWW009"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWW010"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWMLN1"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWALP1"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWUSER"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWPID"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."WWUPMJ")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWJOBN"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."WWUPMT")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWNTYP"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWNICK"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWGEND"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."WWDDATE")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."WWDMON")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."WWDYR")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWWN001"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWWN002"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWWN003"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWWN004"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWWN005"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWWN006"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWWN007"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWWN008"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWWN009"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWWN010"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWFUCO"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWPCM"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWPCF"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWACTIN"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."WWCFRGUID"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."WWSYNCS")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."WWCAAD")),'~'),'\#','\\' || '\#'))|| '\#','\#' || '~'),'~') )) AS "HASH_DIFF"
			, CAST('N' AS VARCHAR) AS "DELETE_FLAG"
			, "STG_INR_SRC"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
			, "STG_INR_SRC"."WWAN8" AS "WWAN8"
			, "STG_INR_SRC"."WWIDLN" AS "WWIDLN"
			, "STG_INR_SRC"."WWDSS5" AS "WWDSS5"
			, "STG_INR_SRC"."WWMLNM" AS "WWMLNM"
			, "STG_INR_SRC"."WWATTL" AS "WWATTL"
			, "STG_INR_SRC"."WWREM1" AS "WWREM1"
			, "STG_INR_SRC"."WWSLNM" AS "WWSLNM"
			, "STG_INR_SRC"."WWALPH" AS "WWALPH"
			, "STG_INR_SRC"."WWDC" AS "WWDC"
			, "STG_INR_SRC"."WWGNNM" AS "WWGNNM"
			, "STG_INR_SRC"."WWMDNM" AS "WWMDNM"
			, "STG_INR_SRC"."WWSRNM" AS "WWSRNM"
			, "STG_INR_SRC"."WWTYC" AS "WWTYC"
			, "STG_INR_SRC"."WWW001" AS "WWW001"
			, "STG_INR_SRC"."WWW002" AS "WWW002"
			, "STG_INR_SRC"."WWW003" AS "WWW003"
			, "STG_INR_SRC"."WWW004" AS "WWW004"
			, "STG_INR_SRC"."WWW005" AS "WWW005"
			, "STG_INR_SRC"."WWW006" AS "WWW006"
			, "STG_INR_SRC"."WWW007" AS "WWW007"
			, "STG_INR_SRC"."WWW008" AS "WWW008"
			, "STG_INR_SRC"."WWW009" AS "WWW009"
			, "STG_INR_SRC"."WWW010" AS "WWW010"
			, "STG_INR_SRC"."WWMLN1" AS "WWMLN1"
			, "STG_INR_SRC"."WWALP1" AS "WWALP1"
			, "STG_INR_SRC"."WWUSER" AS "WWUSER"
			, "STG_INR_SRC"."WWPID" AS "WWPID"
			, "STG_INR_SRC"."WWUPMJ" AS "WWUPMJ"
			, "STG_INR_SRC"."WWJOBN" AS "WWJOBN"
			, "STG_INR_SRC"."WWUPMT" AS "WWUPMT"
			, "STG_INR_SRC"."WWNTYP" AS "WWNTYP"
			, "STG_INR_SRC"."WWNICK" AS "WWNICK"
			, "STG_INR_SRC"."WWGEND" AS "WWGEND"
			, "STG_INR_SRC"."WWDDATE" AS "WWDDATE"
			, "STG_INR_SRC"."WWDMON" AS "WWDMON"
			, "STG_INR_SRC"."WWDYR" AS "WWDYR"
			, "STG_INR_SRC"."WWWN001" AS "WWWN001"
			, "STG_INR_SRC"."WWWN002" AS "WWWN002"
			, "STG_INR_SRC"."WWWN003" AS "WWWN003"
			, "STG_INR_SRC"."WWWN004" AS "WWWN004"
			, "STG_INR_SRC"."WWWN005" AS "WWWN005"
			, "STG_INR_SRC"."WWWN006" AS "WWWN006"
			, "STG_INR_SRC"."WWWN007" AS "WWWN007"
			, "STG_INR_SRC"."WWWN008" AS "WWWN008"
			, "STG_INR_SRC"."WWWN009" AS "WWWN009"
			, "STG_INR_SRC"."WWWN010" AS "WWWN010"
			, "STG_INR_SRC"."WWFUCO" AS "WWFUCO"
			, "STG_INR_SRC"."WWPCM" AS "WWPCM"
			, "STG_INR_SRC"."WWPCF" AS "WWPCF"
			, "STG_INR_SRC"."WWACTIN" AS "WWACTIN"
			, "STG_INR_SRC"."WWCFRGUID" AS "WWCFRGUID"
			, "STG_INR_SRC"."WWSYNCS" AS "WWSYNCS"
			, "STG_INR_SRC"."WWCAAD" AS "WWCAAD"
			, ROW_NUMBER()OVER(PARTITION BY "STG_INR_SRC"."WHOISWHO_HKEY" ORDER BY "STG_INR_SRC"."LOAD_DATE") AS "DUMMY"
		FROM {{ ref('JDEDWARDS_STG_F0111') }} "STG_INR_SRC"
	)
	SELECT 
		  "STG_SRC"."WHOISWHO_HKEY" AS "WHOISWHO_HKEY"
		, "STG_SRC"."LOAD_DATE" AS "LOAD_DATE"
		, "STG_SRC"."LOAD_END_DATE" AS "LOAD_END_DATE"
		, "STG_SRC"."LOAD_CYCLE_ID" AS "LOAD_CYCLE_ID"
		, "STG_SRC"."HASH_DIFF" AS "HASH_DIFF"
		, "STG_SRC"."DELETE_FLAG" AS "DELETE_FLAG"
		, "STG_SRC"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
		, "STG_SRC"."WWAN8" AS "WWAN8"
		, "STG_SRC"."WWIDLN" AS "WWIDLN"
		, "STG_SRC"."WWDSS5" AS "WWDSS5"
		, "STG_SRC"."WWMLNM" AS "WWMLNM"
		, "STG_SRC"."WWATTL" AS "WWATTL"
		, "STG_SRC"."WWREM1" AS "WWREM1"
		, "STG_SRC"."WWSLNM" AS "WWSLNM"
		, "STG_SRC"."WWALPH" AS "WWALPH"
		, "STG_SRC"."WWDC" AS "WWDC"
		, "STG_SRC"."WWGNNM" AS "WWGNNM"
		, "STG_SRC"."WWMDNM" AS "WWMDNM"
		, "STG_SRC"."WWSRNM" AS "WWSRNM"
		, "STG_SRC"."WWTYC" AS "WWTYC"
		, "STG_SRC"."WWW001" AS "WWW001"
		, "STG_SRC"."WWW002" AS "WWW002"
		, "STG_SRC"."WWW003" AS "WWW003"
		, "STG_SRC"."WWW004" AS "WWW004"
		, "STG_SRC"."WWW005" AS "WWW005"
		, "STG_SRC"."WWW006" AS "WWW006"
		, "STG_SRC"."WWW007" AS "WWW007"
		, "STG_SRC"."WWW008" AS "WWW008"
		, "STG_SRC"."WWW009" AS "WWW009"
		, "STG_SRC"."WWW010" AS "WWW010"
		, "STG_SRC"."WWMLN1" AS "WWMLN1"
		, "STG_SRC"."WWALP1" AS "WWALP1"
		, "STG_SRC"."WWUSER" AS "WWUSER"
		, "STG_SRC"."WWPID" AS "WWPID"
		, "STG_SRC"."WWUPMJ" AS "WWUPMJ"
		, "STG_SRC"."WWJOBN" AS "WWJOBN"
		, "STG_SRC"."WWUPMT" AS "WWUPMT"
		, "STG_SRC"."WWNTYP" AS "WWNTYP"
		, "STG_SRC"."WWNICK" AS "WWNICK"
		, "STG_SRC"."WWGEND" AS "WWGEND"
		, "STG_SRC"."WWDDATE" AS "WWDDATE"
		, "STG_SRC"."WWDMON" AS "WWDMON"
		, "STG_SRC"."WWDYR" AS "WWDYR"
		, "STG_SRC"."WWWN001" AS "WWWN001"
		, "STG_SRC"."WWWN002" AS "WWWN002"
		, "STG_SRC"."WWWN003" AS "WWWN003"
		, "STG_SRC"."WWWN004" AS "WWWN004"
		, "STG_SRC"."WWWN005" AS "WWWN005"
		, "STG_SRC"."WWWN006" AS "WWWN006"
		, "STG_SRC"."WWWN007" AS "WWWN007"
		, "STG_SRC"."WWWN008" AS "WWWN008"
		, "STG_SRC"."WWWN009" AS "WWWN009"
		, "STG_SRC"."WWWN010" AS "WWWN010"
		, "STG_SRC"."WWFUCO" AS "WWFUCO"
		, "STG_SRC"."WWPCM" AS "WWPCM"
		, "STG_SRC"."WWPCF" AS "WWPCF"
		, "STG_SRC"."WWACTIN" AS "WWACTIN"
		, "STG_SRC"."WWCFRGUID" AS "WWCFRGUID"
		, "STG_SRC"."WWSYNCS" AS "WWSYNCS"
		, "STG_SRC"."WWCAAD" AS "WWCAAD"
	FROM "STG_SRC" "STG_SRC"
	WHERE  "STG_SRC"."DUMMY" = 1

) final 
where '{{ var("load_type") }}' = 'INIT' and '{{ var("source") }}' = 'JDEDWARDS'