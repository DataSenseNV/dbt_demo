{{
	config(
		materialized='incremental',
		pre_hook= [
			'{% if var("load_type") == "INIT" and var("source") == "JDEDWARDS" %} TRUNCATE TABLE {{ this }}; {% endif %}'
		],
		alias='SAT_JDE_COMPANY',
		schema='DEMO_FL',
		unique_key = ['"COMPANY_HKEY"', '"LOAD_DATE"'],
		merge_update_columns = ['"LOAD_END_DATE"', '"DELETE_FLAG"', '"CDC_TIMESTAMP"'],
		tags=['JDEDWARDS', 'SAT_JDE_COMPANY_INCR', 'SAT_JDE_COMPANY_INIT']
	)
}}
select * from (
	WITH "END_DATING" AS 
	( 
		SELECT 
			  "SAT_TEMP_SRC_DK"."COMPANY_HKEY" AS "COMPANY_HKEY"
			, "SAT_TEMP_SRC_DK"."LOAD_DATE" AS "LOAD_DATE"
			, CASE WHEN LEAD( "SAT_TEMP_SRC_DK"."DELETE_FLAG" || "SAT_TEMP_SRC_DK"."SOURCE",1)OVER(PARTITION BY "SAT_TEMP_SRC_DK"."COMPANY_HKEY" ORDER BY "SAT_TEMP_SRC_DK"."LOAD_DATE",
				"SAT_TEMP_SRC_DK"."LOAD_CYCLE_ID")= 'Y' || 'STG' THEN CAST('Y' AS VARCHAR) ELSE "SAT_TEMP_SRC_DK"."DELETE_FLAG" END AS "DELETE_FLAG"
			, LEAD("SAT_TEMP_SRC_DK"."CDC_TIMESTAMP",1)OVER(PARTITION BY "SAT_TEMP_SRC_DK"."COMPANY_HKEY" ORDER BY "SAT_TEMP_SRC_DK"."LOAD_DATE") AS "CDC_TIMESTAMP"
		FROM {{ ref('JDEDWARDS_STG_SAT_JDE_COMPANY_TMP') }} "SAT_TEMP_SRC_DK"
		WHERE  "SAT_TEMP_SRC_DK"."EQUAL" = 0
	)
	, "CALC_LOAD_END_DATE" AS 
	( 
		SELECT 
			  "SAT_TEMP_SRC_US"."COMPANY_HKEY" AS "COMPANY_HKEY"
			, "SAT_TEMP_SRC_US"."LOAD_DATE" AS "LOAD_DATE"
			, "SAT_TEMP_SRC_US"."LOAD_CYCLE_ID" AS "LOAD_CYCLE_ID"
			, COALESCE(LEAD("SAT_TEMP_SRC_US"."LOAD_DATE",1)OVER(PARTITION BY "SAT_TEMP_SRC_US"."COMPANY_HKEY" ORDER BY "SAT_TEMP_SRC_US"."LOAD_DATE")
				, TO_TIMESTAMP('31/12/2999 23:59:59', 'DD/MM/YYYY HH24:MI:SS')) AS "LOAD_END_DATE"
			, "END_DATING"."DELETE_FLAG" AS "DELETE_FLAG"
			, "SAT_TEMP_SRC_US"."SOURCE" AS "SOURCE"
			, "SAT_TEMP_SRC_US"."HASH_DIFF" AS "HASH_DIFF"
			, CASE WHEN "END_DATING"."DELETE_FLAG" = CAST('Y' AS VARCHAR) THEN "END_DATING"."CDC_TIMESTAMP" ELSE "SAT_TEMP_SRC_US"."CDC_TIMESTAMP" END AS "CDC_TIMESTAMP"
			, "SAT_TEMP_SRC_US"."CCCO" AS "CCCO"
			, "SAT_TEMP_SRC_US"."CCAN8" AS "CCAN8"
			, "SAT_TEMP_SRC_US"."CCNAME" AS "CCNAME"
			, "SAT_TEMP_SRC_US"."CCALTC" AS "CCALTC"
			, "SAT_TEMP_SRC_US"."CCDFYJ" AS "CCDFYJ"
			, "SAT_TEMP_SRC_US"."CCPNC" AS "CCPNC"
			, "SAT_TEMP_SRC_US"."CCDOT1" AS "CCDOT1"
			, "SAT_TEMP_SRC_US"."CCCRYR" AS "CCCRYR"
			, "SAT_TEMP_SRC_US"."CCCRYC" AS "CCCRYC"
			, "SAT_TEMP_SRC_US"."CCDOT2" AS "CCDOT2"
			, "SAT_TEMP_SRC_US"."CCMCUA" AS "CCMCUA"
			, "SAT_TEMP_SRC_US"."CCMCUD" AS "CCMCUD"
			, "SAT_TEMP_SRC_US"."CCMCUC" AS "CCMCUC"
			, "SAT_TEMP_SRC_US"."CCMCUB" AS "CCMCUB"
			, "SAT_TEMP_SRC_US"."CCDPRC" AS "CCDPRC"
			, "SAT_TEMP_SRC_US"."CCBKTX" AS "CCBKTX"
			, "SAT_TEMP_SRC_US"."CCTXBM" AS "CCTXBM"
			, "SAT_TEMP_SRC_US"."CCTXBO" AS "CCTXBO"
			, "SAT_TEMP_SRC_US"."CCNWXJ" AS "CCNWXJ"
			, "SAT_TEMP_SRC_US"."CCGLIE" AS "CCGLIE"
			, "SAT_TEMP_SRC_US"."CCABIN" AS "CCABIN"
			, "SAT_TEMP_SRC_US"."CCCALD" AS "CCCALD"
			, "SAT_TEMP_SRC_US"."CCDTPN" AS "CCDTPN"
			, "SAT_TEMP_SRC_US"."CCPNF" AS "CCPNF"
			, "SAT_TEMP_SRC_US"."CCDFF" AS "CCDFF"
			, "SAT_TEMP_SRC_US"."CCCRCD" AS "CCCRCD"
			, "SAT_TEMP_SRC_US"."CCSMI" AS "CCSMI"
			, "SAT_TEMP_SRC_US"."CCSMU" AS "CCSMU"
			, "SAT_TEMP_SRC_US"."CCSMS" AS "CCSMS"
			, "SAT_TEMP_SRC_US"."CCDNLT" AS "CCDNLT"
			, "SAT_TEMP_SRC_US"."CCSTMT" AS "CCSTMT"
			, "SAT_TEMP_SRC_US"."CCATCS" AS "CCATCS"
			, "SAT_TEMP_SRC_US"."CCALGM" AS "CCALGM"
			, "SAT_TEMP_SRC_US"."CCAGEM" AS "CCAGEM"
			, "SAT_TEMP_SRC_US"."CCCRDY" AS "CCCRDY"
			, "SAT_TEMP_SRC_US"."CCAGR1" AS "CCAGR1"
			, "SAT_TEMP_SRC_US"."CCAGR2" AS "CCAGR2"
			, "SAT_TEMP_SRC_US"."CCAGR3" AS "CCAGR3"
			, "SAT_TEMP_SRC_US"."CCAGR4" AS "CCAGR4"
			, "SAT_TEMP_SRC_US"."CCAGR5" AS "CCAGR5"
			, "SAT_TEMP_SRC_US"."CCAGR6" AS "CCAGR6"
			, "SAT_TEMP_SRC_US"."CCAGR7" AS "CCAGR7"
			, "SAT_TEMP_SRC_US"."CCFRY" AS "CCFRY"
			, "SAT_TEMP_SRC_US"."CCFRP" AS "CCFRP"
			, "SAT_TEMP_SRC_US"."CCNNP" AS "CCNNP"
			, "SAT_TEMP_SRC_US"."CCFP" AS "CCFP"
			, "SAT_TEMP_SRC_US"."CCAGE" AS "CCAGE"
			, "SAT_TEMP_SRC_US"."CCDAG" AS "CCDAG"
			, "SAT_TEMP_SRC_US"."CCARPN" AS "CCARPN"
			, "SAT_TEMP_SRC_US"."CCAPPN" AS "CCAPPN"
			, "SAT_TEMP_SRC_US"."CCARFJ" AS "CCARFJ"
			, "SAT_TEMP_SRC_US"."CCAPFJ" AS "CCAPFJ"
			, "SAT_TEMP_SRC_US"."CCSGBK" AS "CCSGBK"
			, "SAT_TEMP_SRC_US"."CCPTCO" AS "CCPTCO"
			, "SAT_TEMP_SRC_US"."CCX1" AS "CCX1"
			, "SAT_TEMP_SRC_US"."CCX2" AS "CCX2"
			, "SAT_TEMP_SRC_US"."CCUSER" AS "CCUSER"
			, "SAT_TEMP_SRC_US"."CCPID" AS "CCPID"
			, "SAT_TEMP_SRC_US"."CCUPMJ" AS "CCUPMJ"
			, "SAT_TEMP_SRC_US"."CCJOBN" AS "CCJOBN"
			, "SAT_TEMP_SRC_US"."CCUPMT" AS "CCUPMT"
			, "SAT_TEMP_SRC_US"."CCTSID" AS "CCTSID"
			, "SAT_TEMP_SRC_US"."CCTSCO" AS "CCTSCO"
			, "SAT_TEMP_SRC_US"."CCTHCO" AS "CCTHCO"
			, "SAT_TEMP_SRC_US"."CCAN8C" AS "CCAN8C"
		FROM {{ ref('JDEDWARDS_STG_SAT_JDE_COMPANY_TMP') }} "SAT_TEMP_SRC_US"
		INNER JOIN "END_DATING" "END_DATING" ON  "SAT_TEMP_SRC_US"."COMPANY_HKEY" = "END_DATING"."COMPANY_HKEY" AND "SAT_TEMP_SRC_US"."LOAD_DATE" = 
			"END_DATING"."LOAD_DATE"
		WHERE  "SAT_TEMP_SRC_US"."EQUAL" = 0 AND NOT("SAT_TEMP_SRC_US"."DELETE_FLAG" = CAST('Y' AS VARCHAR) AND "SAT_TEMP_SRC_US"."SOURCE" = 'STG')
	)
	, "FILTER_LOAD_END_DATE" AS 
	( 
		SELECT 
			  "CALC_LOAD_END_DATE"."COMPANY_HKEY" AS "COMPANY_HKEY"
			, "CALC_LOAD_END_DATE"."LOAD_DATE" AS "LOAD_DATE"
			, "CALC_LOAD_END_DATE"."LOAD_CYCLE_ID" AS "LOAD_CYCLE_ID"
			, "CALC_LOAD_END_DATE"."LOAD_END_DATE" AS "LOAD_END_DATE"
			, "CALC_LOAD_END_DATE"."DELETE_FLAG" AS "DELETE_FLAG"
			, "CALC_LOAD_END_DATE"."HASH_DIFF" AS "HASH_DIFF"
			, "CALC_LOAD_END_DATE"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
			, "CALC_LOAD_END_DATE"."CCCO" AS "CCCO"
			, "CALC_LOAD_END_DATE"."CCAN8" AS "CCAN8"
			, "CALC_LOAD_END_DATE"."CCNAME" AS "CCNAME"
			, "CALC_LOAD_END_DATE"."CCALTC" AS "CCALTC"
			, "CALC_LOAD_END_DATE"."CCDFYJ" AS "CCDFYJ"
			, "CALC_LOAD_END_DATE"."CCPNC" AS "CCPNC"
			, "CALC_LOAD_END_DATE"."CCDOT1" AS "CCDOT1"
			, "CALC_LOAD_END_DATE"."CCCRYR" AS "CCCRYR"
			, "CALC_LOAD_END_DATE"."CCCRYC" AS "CCCRYC"
			, "CALC_LOAD_END_DATE"."CCDOT2" AS "CCDOT2"
			, "CALC_LOAD_END_DATE"."CCMCUA" AS "CCMCUA"
			, "CALC_LOAD_END_DATE"."CCMCUD" AS "CCMCUD"
			, "CALC_LOAD_END_DATE"."CCMCUC" AS "CCMCUC"
			, "CALC_LOAD_END_DATE"."CCMCUB" AS "CCMCUB"
			, "CALC_LOAD_END_DATE"."CCDPRC" AS "CCDPRC"
			, "CALC_LOAD_END_DATE"."CCBKTX" AS "CCBKTX"
			, "CALC_LOAD_END_DATE"."CCTXBM" AS "CCTXBM"
			, "CALC_LOAD_END_DATE"."CCTXBO" AS "CCTXBO"
			, "CALC_LOAD_END_DATE"."CCNWXJ" AS "CCNWXJ"
			, "CALC_LOAD_END_DATE"."CCGLIE" AS "CCGLIE"
			, "CALC_LOAD_END_DATE"."CCABIN" AS "CCABIN"
			, "CALC_LOAD_END_DATE"."CCCALD" AS "CCCALD"
			, "CALC_LOAD_END_DATE"."CCDTPN" AS "CCDTPN"
			, "CALC_LOAD_END_DATE"."CCPNF" AS "CCPNF"
			, "CALC_LOAD_END_DATE"."CCDFF" AS "CCDFF"
			, "CALC_LOAD_END_DATE"."CCCRCD" AS "CCCRCD"
			, "CALC_LOAD_END_DATE"."CCSMI" AS "CCSMI"
			, "CALC_LOAD_END_DATE"."CCSMU" AS "CCSMU"
			, "CALC_LOAD_END_DATE"."CCSMS" AS "CCSMS"
			, "CALC_LOAD_END_DATE"."CCDNLT" AS "CCDNLT"
			, "CALC_LOAD_END_DATE"."CCSTMT" AS "CCSTMT"
			, "CALC_LOAD_END_DATE"."CCATCS" AS "CCATCS"
			, "CALC_LOAD_END_DATE"."CCALGM" AS "CCALGM"
			, "CALC_LOAD_END_DATE"."CCAGEM" AS "CCAGEM"
			, "CALC_LOAD_END_DATE"."CCCRDY" AS "CCCRDY"
			, "CALC_LOAD_END_DATE"."CCAGR1" AS "CCAGR1"
			, "CALC_LOAD_END_DATE"."CCAGR2" AS "CCAGR2"
			, "CALC_LOAD_END_DATE"."CCAGR3" AS "CCAGR3"
			, "CALC_LOAD_END_DATE"."CCAGR4" AS "CCAGR4"
			, "CALC_LOAD_END_DATE"."CCAGR5" AS "CCAGR5"
			, "CALC_LOAD_END_DATE"."CCAGR6" AS "CCAGR6"
			, "CALC_LOAD_END_DATE"."CCAGR7" AS "CCAGR7"
			, "CALC_LOAD_END_DATE"."CCFRY" AS "CCFRY"
			, "CALC_LOAD_END_DATE"."CCFRP" AS "CCFRP"
			, "CALC_LOAD_END_DATE"."CCNNP" AS "CCNNP"
			, "CALC_LOAD_END_DATE"."CCFP" AS "CCFP"
			, "CALC_LOAD_END_DATE"."CCAGE" AS "CCAGE"
			, "CALC_LOAD_END_DATE"."CCDAG" AS "CCDAG"
			, "CALC_LOAD_END_DATE"."CCARPN" AS "CCARPN"
			, "CALC_LOAD_END_DATE"."CCAPPN" AS "CCAPPN"
			, "CALC_LOAD_END_DATE"."CCARFJ" AS "CCARFJ"
			, "CALC_LOAD_END_DATE"."CCAPFJ" AS "CCAPFJ"
			, "CALC_LOAD_END_DATE"."CCSGBK" AS "CCSGBK"
			, "CALC_LOAD_END_DATE"."CCPTCO" AS "CCPTCO"
			, "CALC_LOAD_END_DATE"."CCX1" AS "CCX1"
			, "CALC_LOAD_END_DATE"."CCX2" AS "CCX2"
			, "CALC_LOAD_END_DATE"."CCUSER" AS "CCUSER"
			, "CALC_LOAD_END_DATE"."CCPID" AS "CCPID"
			, "CALC_LOAD_END_DATE"."CCUPMJ" AS "CCUPMJ"
			, "CALC_LOAD_END_DATE"."CCJOBN" AS "CCJOBN"
			, "CALC_LOAD_END_DATE"."CCUPMT" AS "CCUPMT"
			, "CALC_LOAD_END_DATE"."CCTSID" AS "CCTSID"
			, "CALC_LOAD_END_DATE"."CCTSCO" AS "CCTSCO"
			, "CALC_LOAD_END_DATE"."CCTHCO" AS "CCTHCO"
			, "CALC_LOAD_END_DATE"."CCAN8C" AS "CCAN8C"
		FROM "CALC_LOAD_END_DATE" "CALC_LOAD_END_DATE"
		WHERE  "CALC_LOAD_END_DATE"."DELETE_FLAG" = CAST('Y' AS VARCHAR) OR "CALC_LOAD_END_DATE"."SOURCE" = 'STG' OR("CALC_LOAD_END_DATE"."SOURCE" = 'SAT' AND "CALC_LOAD_END_DATE"."LOAD_END_DATE" != TO_TIMESTAMP('31/12/2999 23:59:59', 'DD/MM/YYYY HH24:MI:SS'))
	)
	SELECT 
		  "FILTER_LOAD_END_DATE"."COMPANY_HKEY"
		, "FILTER_LOAD_END_DATE"."LOAD_DATE"
		, "FILTER_LOAD_END_DATE"."LOAD_END_DATE"
		, "FILTER_LOAD_END_DATE"."LOAD_CYCLE_ID"
		, "FILTER_LOAD_END_DATE"."HASH_DIFF"
		, "FILTER_LOAD_END_DATE"."DELETE_FLAG"
		, "FILTER_LOAD_END_DATE"."CDC_TIMESTAMP"
		, "FILTER_LOAD_END_DATE"."CCCO"
		, "FILTER_LOAD_END_DATE"."CCAN8"
		, "FILTER_LOAD_END_DATE"."CCNAME"
		, "FILTER_LOAD_END_DATE"."CCALTC"
		, "FILTER_LOAD_END_DATE"."CCDFYJ"
		, "FILTER_LOAD_END_DATE"."CCPNC"
		, "FILTER_LOAD_END_DATE"."CCDOT1"
		, "FILTER_LOAD_END_DATE"."CCCRYR"
		, "FILTER_LOAD_END_DATE"."CCCRYC"
		, "FILTER_LOAD_END_DATE"."CCDOT2"
		, "FILTER_LOAD_END_DATE"."CCMCUA"
		, "FILTER_LOAD_END_DATE"."CCMCUD"
		, "FILTER_LOAD_END_DATE"."CCMCUC"
		, "FILTER_LOAD_END_DATE"."CCMCUB"
		, "FILTER_LOAD_END_DATE"."CCDPRC"
		, "FILTER_LOAD_END_DATE"."CCBKTX"
		, "FILTER_LOAD_END_DATE"."CCTXBM"
		, "FILTER_LOAD_END_DATE"."CCTXBO"
		, "FILTER_LOAD_END_DATE"."CCNWXJ"
		, "FILTER_LOAD_END_DATE"."CCGLIE"
		, "FILTER_LOAD_END_DATE"."CCABIN"
		, "FILTER_LOAD_END_DATE"."CCCALD"
		, "FILTER_LOAD_END_DATE"."CCDTPN"
		, "FILTER_LOAD_END_DATE"."CCPNF"
		, "FILTER_LOAD_END_DATE"."CCDFF"
		, "FILTER_LOAD_END_DATE"."CCCRCD"
		, "FILTER_LOAD_END_DATE"."CCSMI"
		, "FILTER_LOAD_END_DATE"."CCSMU"
		, "FILTER_LOAD_END_DATE"."CCSMS"
		, "FILTER_LOAD_END_DATE"."CCDNLT"
		, "FILTER_LOAD_END_DATE"."CCSTMT"
		, "FILTER_LOAD_END_DATE"."CCATCS"
		, "FILTER_LOAD_END_DATE"."CCALGM"
		, "FILTER_LOAD_END_DATE"."CCAGEM"
		, "FILTER_LOAD_END_DATE"."CCCRDY"
		, "FILTER_LOAD_END_DATE"."CCAGR1"
		, "FILTER_LOAD_END_DATE"."CCAGR2"
		, "FILTER_LOAD_END_DATE"."CCAGR3"
		, "FILTER_LOAD_END_DATE"."CCAGR4"
		, "FILTER_LOAD_END_DATE"."CCAGR5"
		, "FILTER_LOAD_END_DATE"."CCAGR6"
		, "FILTER_LOAD_END_DATE"."CCAGR7"
		, "FILTER_LOAD_END_DATE"."CCFRY"
		, "FILTER_LOAD_END_DATE"."CCFRP"
		, "FILTER_LOAD_END_DATE"."CCNNP"
		, "FILTER_LOAD_END_DATE"."CCFP"
		, "FILTER_LOAD_END_DATE"."CCAGE"
		, "FILTER_LOAD_END_DATE"."CCDAG"
		, "FILTER_LOAD_END_DATE"."CCARPN"
		, "FILTER_LOAD_END_DATE"."CCAPPN"
		, "FILTER_LOAD_END_DATE"."CCARFJ"
		, "FILTER_LOAD_END_DATE"."CCAPFJ"
		, "FILTER_LOAD_END_DATE"."CCSGBK"
		, "FILTER_LOAD_END_DATE"."CCPTCO"
		, "FILTER_LOAD_END_DATE"."CCX1"
		, "FILTER_LOAD_END_DATE"."CCX2"
		, "FILTER_LOAD_END_DATE"."CCUSER"
		, "FILTER_LOAD_END_DATE"."CCPID"
		, "FILTER_LOAD_END_DATE"."CCUPMJ"
		, "FILTER_LOAD_END_DATE"."CCJOBN"
		, "FILTER_LOAD_END_DATE"."CCUPMT"
		, "FILTER_LOAD_END_DATE"."CCTSID"
		, "FILTER_LOAD_END_DATE"."CCTSCO"
		, "FILTER_LOAD_END_DATE"."CCTHCO"
		, "FILTER_LOAD_END_DATE"."CCAN8C"
	FROM "FILTER_LOAD_END_DATE"

) final 
where '{{ var("load_type") }}' = 'INCR' and '{{ var("source") }}' = 'JDEDWARDS'

UNION ALL

select * from (
	WITH "STG_SRC" AS 
	( 
		SELECT 
			  "STG_INR_SRC"."COMPANY_HKEY" AS "COMPANY_HKEY"
			, "STG_INR_SRC"."LOAD_DATE" AS "LOAD_DATE"
			, TO_TIMESTAMP('31/12/2999 23:59:59' , 'DD/MM/YYYY HH24:MI:SS') AS "LOAD_END_DATE"
			, "STG_INR_SRC"."LOAD_CYCLE_ID" AS "LOAD_CYCLE_ID"
			, UPPER(MD5_HEX(COALESCE(RTRIM( UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCNAME"),'~'),'\#','\\' || '\#'))
				|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCALTC"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCDFYJ")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCPNC")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCDOT1"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCCRYR"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCCRYC"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCDOT2"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCMCUA"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCMCUD"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCMCUC"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCMCUB"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCDPRC"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCBKTX"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCTXBM")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCTXBO")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCNWXJ")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCGLIE"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCABIN"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCCALD"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCDTPN"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCPNF")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCDFF")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCCRCD"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCSMI"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCSMU"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCSMS"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCDNLT"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCSTMT"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCATCS"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCALGM"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCAGEM"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCCRDY")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCAGR1")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCAGR2")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCAGR3")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCAGR4")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCAGR5")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCAGR6")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCAGR7")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCFRY")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCFRP")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCNNP")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCFP")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCAGE"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCDAG")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCARPN")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCAPPN")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCARFJ")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCAPFJ")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCSGBK"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCPTCO"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCX1"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCX2"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCUSER"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCPID"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCUPMJ")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCJOBN"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCUPMT")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCTSID")),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCTSCO"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( "STG_INR_SRC"."CCTHCO"),'~'),'\#','\\' || '\#'))|| '\#' ||  UPPER(REPLACE(COALESCE(TRIM( TO_CHAR("STG_INR_SRC"."CCAN8C")),'~'),'\#','\\' || '\#'))|| '\#','\#' || '~'),'~') )) AS "HASH_DIFF"
			, CAST('N' AS VARCHAR) AS "DELETE_FLAG"
			, "STG_INR_SRC"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
			, "STG_INR_SRC"."CCCO" AS "CCCO"
			, "STG_INR_SRC"."CCAN8" AS "CCAN8"
			, "STG_INR_SRC"."CCNAME" AS "CCNAME"
			, "STG_INR_SRC"."CCALTC" AS "CCALTC"
			, "STG_INR_SRC"."CCDFYJ" AS "CCDFYJ"
			, "STG_INR_SRC"."CCPNC" AS "CCPNC"
			, "STG_INR_SRC"."CCDOT1" AS "CCDOT1"
			, "STG_INR_SRC"."CCCRYR" AS "CCCRYR"
			, "STG_INR_SRC"."CCCRYC" AS "CCCRYC"
			, "STG_INR_SRC"."CCDOT2" AS "CCDOT2"
			, "STG_INR_SRC"."CCMCUA" AS "CCMCUA"
			, "STG_INR_SRC"."CCMCUD" AS "CCMCUD"
			, "STG_INR_SRC"."CCMCUC" AS "CCMCUC"
			, "STG_INR_SRC"."CCMCUB" AS "CCMCUB"
			, "STG_INR_SRC"."CCDPRC" AS "CCDPRC"
			, "STG_INR_SRC"."CCBKTX" AS "CCBKTX"
			, "STG_INR_SRC"."CCTXBM" AS "CCTXBM"
			, "STG_INR_SRC"."CCTXBO" AS "CCTXBO"
			, "STG_INR_SRC"."CCNWXJ" AS "CCNWXJ"
			, "STG_INR_SRC"."CCGLIE" AS "CCGLIE"
			, "STG_INR_SRC"."CCABIN" AS "CCABIN"
			, "STG_INR_SRC"."CCCALD" AS "CCCALD"
			, "STG_INR_SRC"."CCDTPN" AS "CCDTPN"
			, "STG_INR_SRC"."CCPNF" AS "CCPNF"
			, "STG_INR_SRC"."CCDFF" AS "CCDFF"
			, "STG_INR_SRC"."CCCRCD" AS "CCCRCD"
			, "STG_INR_SRC"."CCSMI" AS "CCSMI"
			, "STG_INR_SRC"."CCSMU" AS "CCSMU"
			, "STG_INR_SRC"."CCSMS" AS "CCSMS"
			, "STG_INR_SRC"."CCDNLT" AS "CCDNLT"
			, "STG_INR_SRC"."CCSTMT" AS "CCSTMT"
			, "STG_INR_SRC"."CCATCS" AS "CCATCS"
			, "STG_INR_SRC"."CCALGM" AS "CCALGM"
			, "STG_INR_SRC"."CCAGEM" AS "CCAGEM"
			, "STG_INR_SRC"."CCCRDY" AS "CCCRDY"
			, "STG_INR_SRC"."CCAGR1" AS "CCAGR1"
			, "STG_INR_SRC"."CCAGR2" AS "CCAGR2"
			, "STG_INR_SRC"."CCAGR3" AS "CCAGR3"
			, "STG_INR_SRC"."CCAGR4" AS "CCAGR4"
			, "STG_INR_SRC"."CCAGR5" AS "CCAGR5"
			, "STG_INR_SRC"."CCAGR6" AS "CCAGR6"
			, "STG_INR_SRC"."CCAGR7" AS "CCAGR7"
			, "STG_INR_SRC"."CCFRY" AS "CCFRY"
			, "STG_INR_SRC"."CCFRP" AS "CCFRP"
			, "STG_INR_SRC"."CCNNP" AS "CCNNP"
			, "STG_INR_SRC"."CCFP" AS "CCFP"
			, "STG_INR_SRC"."CCAGE" AS "CCAGE"
			, "STG_INR_SRC"."CCDAG" AS "CCDAG"
			, "STG_INR_SRC"."CCARPN" AS "CCARPN"
			, "STG_INR_SRC"."CCAPPN" AS "CCAPPN"
			, "STG_INR_SRC"."CCARFJ" AS "CCARFJ"
			, "STG_INR_SRC"."CCAPFJ" AS "CCAPFJ"
			, "STG_INR_SRC"."CCSGBK" AS "CCSGBK"
			, "STG_INR_SRC"."CCPTCO" AS "CCPTCO"
			, "STG_INR_SRC"."CCX1" AS "CCX1"
			, "STG_INR_SRC"."CCX2" AS "CCX2"
			, "STG_INR_SRC"."CCUSER" AS "CCUSER"
			, "STG_INR_SRC"."CCPID" AS "CCPID"
			, "STG_INR_SRC"."CCUPMJ" AS "CCUPMJ"
			, "STG_INR_SRC"."CCJOBN" AS "CCJOBN"
			, "STG_INR_SRC"."CCUPMT" AS "CCUPMT"
			, "STG_INR_SRC"."CCTSID" AS "CCTSID"
			, "STG_INR_SRC"."CCTSCO" AS "CCTSCO"
			, "STG_INR_SRC"."CCTHCO" AS "CCTHCO"
			, "STG_INR_SRC"."CCAN8C" AS "CCAN8C"
			, ROW_NUMBER()OVER(PARTITION BY "STG_INR_SRC"."COMPANY_HKEY" ORDER BY "STG_INR_SRC"."LOAD_DATE") AS "DUMMY"
		FROM {{ ref('JDEDWARDS_STG_F0010') }} "STG_INR_SRC"
	)
	SELECT 
		  "STG_SRC"."COMPANY_HKEY" AS "COMPANY_HKEY"
		, "STG_SRC"."LOAD_DATE" AS "LOAD_DATE"
		, "STG_SRC"."LOAD_END_DATE" AS "LOAD_END_DATE"
		, "STG_SRC"."LOAD_CYCLE_ID" AS "LOAD_CYCLE_ID"
		, "STG_SRC"."HASH_DIFF" AS "HASH_DIFF"
		, "STG_SRC"."DELETE_FLAG" AS "DELETE_FLAG"
		, "STG_SRC"."CDC_TIMESTAMP" AS "CDC_TIMESTAMP"
		, "STG_SRC"."CCCO" AS "CCCO"
		, "STG_SRC"."CCAN8" AS "CCAN8"
		, "STG_SRC"."CCNAME" AS "CCNAME"
		, "STG_SRC"."CCALTC" AS "CCALTC"
		, "STG_SRC"."CCDFYJ" AS "CCDFYJ"
		, "STG_SRC"."CCPNC" AS "CCPNC"
		, "STG_SRC"."CCDOT1" AS "CCDOT1"
		, "STG_SRC"."CCCRYR" AS "CCCRYR"
		, "STG_SRC"."CCCRYC" AS "CCCRYC"
		, "STG_SRC"."CCDOT2" AS "CCDOT2"
		, "STG_SRC"."CCMCUA" AS "CCMCUA"
		, "STG_SRC"."CCMCUD" AS "CCMCUD"
		, "STG_SRC"."CCMCUC" AS "CCMCUC"
		, "STG_SRC"."CCMCUB" AS "CCMCUB"
		, "STG_SRC"."CCDPRC" AS "CCDPRC"
		, "STG_SRC"."CCBKTX" AS "CCBKTX"
		, "STG_SRC"."CCTXBM" AS "CCTXBM"
		, "STG_SRC"."CCTXBO" AS "CCTXBO"
		, "STG_SRC"."CCNWXJ" AS "CCNWXJ"
		, "STG_SRC"."CCGLIE" AS "CCGLIE"
		, "STG_SRC"."CCABIN" AS "CCABIN"
		, "STG_SRC"."CCCALD" AS "CCCALD"
		, "STG_SRC"."CCDTPN" AS "CCDTPN"
		, "STG_SRC"."CCPNF" AS "CCPNF"
		, "STG_SRC"."CCDFF" AS "CCDFF"
		, "STG_SRC"."CCCRCD" AS "CCCRCD"
		, "STG_SRC"."CCSMI" AS "CCSMI"
		, "STG_SRC"."CCSMU" AS "CCSMU"
		, "STG_SRC"."CCSMS" AS "CCSMS"
		, "STG_SRC"."CCDNLT" AS "CCDNLT"
		, "STG_SRC"."CCSTMT" AS "CCSTMT"
		, "STG_SRC"."CCATCS" AS "CCATCS"
		, "STG_SRC"."CCALGM" AS "CCALGM"
		, "STG_SRC"."CCAGEM" AS "CCAGEM"
		, "STG_SRC"."CCCRDY" AS "CCCRDY"
		, "STG_SRC"."CCAGR1" AS "CCAGR1"
		, "STG_SRC"."CCAGR2" AS "CCAGR2"
		, "STG_SRC"."CCAGR3" AS "CCAGR3"
		, "STG_SRC"."CCAGR4" AS "CCAGR4"
		, "STG_SRC"."CCAGR5" AS "CCAGR5"
		, "STG_SRC"."CCAGR6" AS "CCAGR6"
		, "STG_SRC"."CCAGR7" AS "CCAGR7"
		, "STG_SRC"."CCFRY" AS "CCFRY"
		, "STG_SRC"."CCFRP" AS "CCFRP"
		, "STG_SRC"."CCNNP" AS "CCNNP"
		, "STG_SRC"."CCFP" AS "CCFP"
		, "STG_SRC"."CCAGE" AS "CCAGE"
		, "STG_SRC"."CCDAG" AS "CCDAG"
		, "STG_SRC"."CCARPN" AS "CCARPN"
		, "STG_SRC"."CCAPPN" AS "CCAPPN"
		, "STG_SRC"."CCARFJ" AS "CCARFJ"
		, "STG_SRC"."CCAPFJ" AS "CCAPFJ"
		, "STG_SRC"."CCSGBK" AS "CCSGBK"
		, "STG_SRC"."CCPTCO" AS "CCPTCO"
		, "STG_SRC"."CCX1" AS "CCX1"
		, "STG_SRC"."CCX2" AS "CCX2"
		, "STG_SRC"."CCUSER" AS "CCUSER"
		, "STG_SRC"."CCPID" AS "CCPID"
		, "STG_SRC"."CCUPMJ" AS "CCUPMJ"
		, "STG_SRC"."CCJOBN" AS "CCJOBN"
		, "STG_SRC"."CCUPMT" AS "CCUPMT"
		, "STG_SRC"."CCTSID" AS "CCTSID"
		, "STG_SRC"."CCTSCO" AS "CCTSCO"
		, "STG_SRC"."CCTHCO" AS "CCTHCO"
		, "STG_SRC"."CCAN8C" AS "CCAN8C"
	FROM "STG_SRC" "STG_SRC"
	WHERE  "STG_SRC"."DUMMY" = 1

) final 
where '{{ var("load_type") }}' = 'INIT' and '{{ var("source") }}' = 'JDEDWARDS'